(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1d7b3482"],{1619:function(e,t,l){"use strict";l("3b2b")},"37b0":function(e,t,l){"use strict";l("9289")},9289:function(e,t,l){var r=l("cfd8");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,l("499e").default)("5ca6f26f",r,!0,{sourceMap:!1,shadowMode:!1})},"9306f":function(e,t,l){"use strict";l("7f7f"),l("8e6e"),l("ac6a"),l("456d"),l("96cf");var r=l("1da1"),i=l("ade3"),a=l("2909"),o=(l("3b2b"),l("1c46"),l("1619"),l("b056"));function s(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,r)}return l}function n(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?s(Object(l),!0).forEach((function(t){Object(i.a)(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):s(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}var d,c={data:function(){var e=function(e,t,l){""!=t&&(!RegExp("^[a-zA-Z][a-zA-Z0-9_]*$").test(t)||t.length<2||t.length>100)?l(new Error("必须以英文开头，数字，下划线组合，2-100字符以内")):l()};return{dialogVisible:!1,type:1,roleList:[],ruleForm:{id:0,dbName:"",tableName:"",tableAlias:"",format:"",delimitId:1,roleId:"",desc:"",createPer:"",createPerName:"",createTime:"",tableFieldInfos:[{fieldName:"",fieldType:"",fieldAlias:"",isPartition:0,primaryKey:0,fieldOrder:""}]},file:"",fileList:[],limitNum:2,optionsOne:[],optionsTwo:[],optionsThree:[],options01:[],options02:[{value:1,label:"是"},{value:0,label:"否"}],rules:{dbName:[{required:!0,message:"请选择类型",trigger:"change"}],tableName:[{required:!0,message:"请输入表名",trigger:"blur"},{validator:e,trigger:"blur"}],format:[{required:!0,message:"请选择格式",trigger:"change"}],delimitId:[{required:!0,message:"请选择格式",trigger:"change"}],roleId:[{required:!0,message:"请选择角色授权",trigger:"change"}],tableAlias:[{required:!0,message:"请填写表别名",trigger:"blur"}],desc:[{required:!0,message:"请填写表描述",trigger:"blur"}],fieldName:[{required:!0,message:"请输入字段名",trigger:"blur"},{validator:e,trigger:"blur"}]}}},computed:{title:function(){return this.ruleForm.id?2==this.type?"复制表":"编辑表":"新建表"}},methods:{diaClose:function(){this.ruleForm.delimitId=1},handleClose:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))},tableNameEn:function(e){new RegExp("^[a-zA-Z][-_0-9a-zA-Z]*$").test(e.target.value)||(e.target.value="")},addNew:function(){this.ruleForm.tableFieldInfos.push({fieldName:"",fieldType:"",fieldAlias:"",isPartition:0,primaryKey:0,fieldOrder:""})},deleteCur:function(e){this.ruleForm.tableFieldInfos.splice(e,1)},addNext:function(e){var t=this.ruleForm.tableFieldInfos[e].fieldType,l=this.ruleForm.tableFieldInfos[e].isPartition;this.ruleForm.tableFieldInfos.splice(e+1,0,{fieldName:"",fieldType:t,fieldAlias:"",isPartition:l,primaryKey:0,fieldOrder:""})},exceedFile:function(e,t){this.$notify.warning({title:"警告",message:"只能选择 ".concat(this.limitNum," 个文件，当前共选择了 ").concat(e.length+t.length," 个")})},fileChange:function(e,t){t.length>1&&t.splice(0,1),this.fileList=t,this.file=e.raw,this.uploadFile()},handleRemove:function(e,t){this.fileList=t},beforeUploadFile:function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1),l=e.size/1024/1024;"csv"!==t&&this.$message({message:"只能上传csv的文件",type:"警告"}),l>10&&this.$message({message:"文件大小不得超过10M",type:"警告"})},handleSuccess:function(e,t,l){this.$message({message:"上传成功！",type:"success"})},handleError:function(e,t,l){this.$message.error("文件上传失败")},uploadFile:function(){var e=this;if(0==this.fileList.length)return this.$message.error("请选择要上传的文件！"),!1;var t=new FormData;t.append("file",this.file);var l=t;this.$API.file(this.$URL.getTableInfoUploadField,l,(function(t){var l;0==t.code?(e.file="",e.$refs.uploadFile.clearFiles(),0==e.ruleForm.id&&(e.ruleForm.tableFieldInfos=[]),(l=e.ruleForm.tableFieldInfos).push.apply(l,Object(a.a)(t.data)),e.$message({message:"操作成功",type:"success",duration:1500,onClose:function(){}})):(e.file="",e.$refs.uploadFile.clearFiles(),e.$message.error(t.msg))}))},downloadFile:function(){var e=this;this.$API.downLoad(this.$URL.getTableInfoDownloadField,{},(function(t){e.download(t.data,t.headers.filename)}))},download:function(e,t){if(e){var l=window.URL.createObjectURL(new Blob([e])),r=document.createElement("a");r.style.display="none",r.href=l,r.setAttribute("download",t),document.body.appendChild(r),r.click()}},getlistDbs:function(){var e=this;this.$API.get(this.$URL.getTableInfoListDbs,{},(function(t){if(0==t.code){e.optionsOne=[];for(var l=0;l<t.data.length;l++)e.optionsOne.push({value:t.data[l],name:t.data[l]})}else e.$message.error(t.msg)}))},getlistFormat:function(){var e=this;this.$API.get(this.$URL.getTableInfoListDataFormats,{},(function(t){if(0==t.code){e.optionsTwo=[];for(var l=0;l<t.data.length;l++)e.optionsTwo.push({value:t.data[l],name:t.data[l]})}else e.$message.error(t.msg)}))},getlistDelimit:function(){var e=this;this.$API.get(this.$URL.getTableInfoListDelimitFormats,{},(function(t){0==t.code?(e.optionsThree=[],e.optionsThree=t.data):e.$message.error(t.msg)}))},listDataTypes:function(){var e=this;this.$API.get(this.$URL.getTableInfoListDataTypes,{},(function(t){if(0==t.code){e.options01=[];for(var l=0;l<t.data.length;l++)e.options01.push({value:t.data[l],name:t.data[l]})}else e.$message.error(t.msg)}))},getTableDetail:function(e){var t=this;this.$API.get(this.$URL.getTableInfoInfo+e,{page:1,limit:999},(function(e){0===e.code?t.ruleForm=e.data:t.$message.error(e.msg)}))},sure:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(t){for(var l=0;l<e.ruleForm.tableFieldInfos.length;l++)e.ruleForm.tableFieldInfos[l].fieldOrder=l+1;var r={};"text"==e.ruleForm.format&&(r={delimitId:e.ruleForm.delimitId});var i=n(n({id:e.ruleForm.id?e.ruleForm.id:null,dbName:e.ruleForm.dbName,tableName:e.ruleForm.tableName,format:e.ruleForm.format},r),{},{roleId:e.ruleForm.roleId,tableAlias:e.ruleForm.tableAlias,longLifeFlag:e.ruleForm.longLifeFlag,storeEngine:e.ruleForm.storeEngine,desc:e.ruleForm.desc,tableFieldInfos:e.ruleForm.tableFieldInfos});e.$API.post("".concat(e.ruleForm.id&&2!=e.type?e.$URL.getTableInfoUpdate:e.$URL.getTableInfoSave),i,(function(t){0===t.code?(e.$refs.ruleForm.resetFields(),e.ruleForm.tableFieldInfos=[{fieldName:"",fieldType:"",fieldAlias:"",isPartition:0,primaryKey:0,fieldOrder:""}],e.$emit("refreshDataList"),e.dialogVisible=!1,e.$message({message:"操作成功！",type:"success"})):e.$message.error(t.msg)}))}}))},getRoleList:(d=Object(r.a)(regeneratorRuntime.mark((function e(){var t,l,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.d)();case 2:t=e.sent,l=t.data.data,r=void 0===l?[]:l,this.roleList=r;case 6:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),init:function(e,t){this.dialogVisible=!0,this.type=t,this.getlistDbs(),this.getlistFormat(),this.getlistDelimit(),this.listDataTypes(),this.getRoleList(),this.ruleForm.id=e||0,e?this.$nextTick((function(){this.getTableDetail(e)})):this.$nextTick((function(){this.$refs.ruleForm.resetFields(),this.ruleForm.tableFieldInfos=[{roleId:"",fieldName:"",fieldType:"",fieldAlias:"",isPartition:0,primaryKey:0,fieldOrder:""}]}))}},mounted:function(){}},u=(l("37b0"),l("2877")),f=Object(u.a)(c,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-add-or-edit"},[t("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,customClass:"customWidth",width:"80% !important"},on:{close:e.diaClose,"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px","label-position":"left"}},[t("el-form-item",{staticClass:"topform",attrs:{label:"数据库",prop:"dbName"}},[t("el-select",{staticStyle:{width:"280px"},attrs:{placeholder:"请选择",disabled:0!=e.ruleForm.id&&2!=e.type},model:{value:e.ruleForm.dbName,callback:function(t){e.$set(e.ruleForm,"dbName",t)},expression:"ruleForm.dbName"}},e._l(e.optionsOne,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"topform",attrs:{label:"中文表名",prop:"tableAlias"}},[t("el-input",{attrs:{placeholder:"用简短中文描述表的业务含义"},model:{value:e.ruleForm.tableAlias,callback:function(t){e.$set(e.ruleForm,"tableAlias",t)},expression:"ruleForm.tableAlias"}})],1),t("el-form-item",{staticClass:"topform",attrs:{label:"英文表名称",prop:"tableName"}},[t("el-input",{staticStyle:{width:"280px"},attrs:{placeholder:"请输入英文表名"},model:{value:e.ruleForm.tableName,callback:function(t){e.$set(e.ruleForm,"tableName",t)},expression:"ruleForm.tableName"}})],1),t("el-form-item",{staticClass:"topformtwo",attrs:{label:"格式",prop:"format"}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"请注意：修改数据表格式后历史数据可能无法显示",placement:"top"}},[t("el-select",{attrs:{placeholder:"请选择格式"},model:{value:e.ruleForm.format,callback:function(t){e.$set(e.ruleForm,"format",t)},expression:"ruleForm.format"}},e._l(e.optionsTwo,(function(e){return t("el-option",{key:e.value,attrs:{filterable:"",label:e.label,value:e.value}})})),1)],1)],1),"text"==e.ruleForm.format?t("el-form-item",{staticClass:"topformtwo",attrs:{label:"分割符",prop:"delimitId"}},[t("el-select",{attrs:{placeholder:"请选择分隔符"},model:{value:e.ruleForm.delimitId,callback:function(t){e.$set(e.ruleForm,"delimitId",t)},expression:"ruleForm.delimitId"}},e._l(e.optionsThree,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),1!==e.type?t("el-form-item",{attrs:{label:"初始角色授权",prop:"roleId"}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"新建表需要初始角色默认授权，后期权限修改请前往权限管理中进行修改",placement:"top"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择初始角色授权"},model:{value:e.ruleForm.roleId,callback:function(t){e.$set(e.ruleForm,"roleId",t)},expression:"ruleForm.roleId"}},e._l(e.roleList,(function(e){return t("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})})),1)],1)],1):e._e(),t("el-form-item",{staticClass:"textarea",attrs:{label:"表描述",prop:"desc"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",placeholder:"填写表描述"},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.ruleForm.tableFieldInfos}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"50",align:"center"}}),t("el-table-column",{attrs:{label:"字段名",width:"280"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{attrs:{prop:"tableFieldInfos."+l.$index+".fieldName",rules:e.rules.fieldName}},[t("el-input",{attrs:{placeholder:"请输入英文"},model:{value:l.row.fieldName,callback:function(t){e.$set(l.row,"fieldName",t)},expression:"scope.row.fieldName"}})],1)]}}])}),t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{attrs:{prop:"tableFieldInfos."+l.$index+".fieldType",rules:{required:!0,message:"类型不能为空",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:l.row.fieldType,callback:function(t){e.$set(l.row,"fieldType",t)},expression:"scope.row.fieldType"}},e._l(e.options01,(function(e,l){return t("el-option",{key:l,attrs:{label:e.label,value:e.value}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"分区"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{attrs:{prop:"tableFieldInfos."+l.$index+".isPartition",rules:{required:!0,message:"分区不能为空",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:l.row.isPartition,callback:function(t){e.$set(l.row,"isPartition",t)},expression:"scope.row.isPartition"}},e._l(e.options02,(function(e,l){return t("el-option",{key:l,attrs:{label:e.label,value:e.value}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"业务含义"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{attrs:{prop:"tableFieldInfos."+l.$index+".fieldAlias",rules:{required:!0,message:"业务含义不能为空",trigger:"blur"}}},[t("el-input",{model:{value:l.row.fieldAlias,callback:function(t){e.$set(l.row,"fieldAlias",t)},expression:"scope.row.fieldAlias"}})],1)]}}])}),2==e.ruleForm.storeEngine?t("el-table-column",{attrs:{width:"80",label:"主键"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{attrs:{prop:"tableFieldInfos."+l.$index+".primaryKey"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:l.row.primaryKey,callback:function(t){e.$set(l.row,"primaryKey",t)},expression:"scope.row.primaryKey"}},e._l(e.options02,(function(e,l){return t("el-option",{key:l,attrs:{label:e.label,value:e.value}})})),1)],1)]}}],null,!1,101464876)}):e._e(),t("el-table-column",{attrs:{label:"操作","header-align":"right",align:"right",width:"110"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.deleteCur(l.$index)}}},[e._v("删除")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addNext(l.$index)}}},[e._v("插入")])]}}])})],1)],1),t("ul",{staticClass:"addNew clearfix"},[t("li",{staticClass:"file",on:{click:function(t){return e.addNew()}}},[t("i",{staticClass:"el-icon-plus"}),e._v("添加新字段")]),t("li",{staticClass:"fr"},[t("el-upload",{ref:"uploadFile",staticClass:"fl",staticStyle:{"margin-right":"10px"},attrs:{action:"null",limit:e.limitNum,"auto-upload":!1,accept:".csv","before-upload":e.beforeUploadFile,"on-change":e.fileChange,"on-remove":e.handleRemove,"on-exceed":e.exceedFile,"on-success":e.handleSuccess,"on-error":e.handleError,"file-list":e.fileList}},[t("div",{staticClass:"file",attrs:{size:"small",plain:""}},[t("i",{staticClass:"el-icon-upload2"}),e._v("上传字段")])]),t("div",{staticClass:"file fl",on:{click:function(t){return e.downloadFile()}}},[t("i",{staticClass:"el-icon-download"}),e._v("下载模板")])],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.sure()}}},[e._v("确定")])],1)],1)],1)}),[],!1,null,null,null);t.a=f.exports},cfd8:function(e,t,l){(e.exports=l("2350")(!1)).push([e.i,".primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.table-add-or-edit{text-align:left}.table-add-or-edit .customWidth{width:80%;max-width:1000px}.table-add-or-edit .el-dialog .topform{width:50%;display:inline-block}.table-add-or-edit .el-dialog .topformtwo{width:33.33%;display:inline-block}.table-add-or-edit .el-dialog .textarea{width:100%}.table-add-or-edit .el-dialog .addNew{width:100%;height:40px;line-height:40px;color:#000;text-align:center;border:1px dashed #cdced5;padding:0 10px}.table-add-or-edit .el-dialog .addNew .file{display:inline-block;cursor:pointer}.table-add-or-edit .el-dialog .el-table .delete{color:#f5222d}.table-add-or-edit .el-dialog .el-table .primary{color:#1740dc}.table-add-or-edit .el-dialog .el-table .el-form-item .el-form-item__content{margin-left:0!important}",""])}}]);