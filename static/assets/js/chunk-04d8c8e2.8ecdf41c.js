(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-04d8c8e2","chunk-74af32dc"],{"01ff":function(e,t,a){"use strict";a.d(t,"i",(function(){return n})),a.d(t,"g",(function(){return s})),a.d(t,"k",(function(){return o})),a.d(t,"f",(function(){return l})),a.d(t,"l",(function(){return c})),a.d(t,"j",(function(){return u})),a.d(t,"a",(function(){return d})),a.d(t,"e",(function(){return f})),a.d(t,"c",(function(){return p})),a.d(t,"b",(function(){return h})),a.d(t,"m",(function(){return m})),a.d(t,"h",(function(){return b})),a.d(t,"d",(function(){return g}));var r=a("2b0e"),i=a("fedb"),n=function(e){return r.default.http.post(i.a.getSyncPageList,e)},s=function(e){return r.default.http.post(i.a.getSyncListByDataSource,e)},o=function(e){return r.default.http.post(i.a.getSyncTableListByDataBase,e)},l=function(){return r.default.http.get(i.a.getSyncHiveList)},c=function(){return r.default.http.get(i.a.getSyncWriteRuleList)},u=function(){return r.default.http.get(i.a.getSyncStorageFormatList)},d=function(e){return r.default.http.post(i.a.addTotalSync,e)},f=function(e){var t=e.id;return r.default.http.get(i.a.getSyncDetail+"/".concat(t))},p=function(e){return r.default.http.post(i.a.editSync,e)},h=function(e){return r.default.http.post(i.a.deleteSync,e)},m=function(e){var t=e.id,a=e.syncQueue;return r.default.http.get(i.a.tableOrDataSync+"/".concat(t,"/").concat(a))},b=function(e){var t=e.id;return r.default.http.get(i.a.getSyncLogInfo+"/".concat(t))},g=function(){return r.default.http.get(i.a.getRoleSelectNew)}},"05b6":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".primary-color[data-v-5035a7b5]{color:#1740dc}.success-color[data-v-5035a7b5]{color:#52c41a}.warning-color[data-v-5035a7b5]{color:#faad14}.error-color[data-v-5035a7b5]{color:#f5222d}.info-color[data-v-5035a7b5]{color:#909399}.border-color[data-v-5035a7b5]{border:1px solid #e5e6e9}.detail[data-v-5035a7b5] .el-alert__content{width:100%}.detail[data-v-5035a7b5] .el-alert__title{width:95%}.sync-task .info[data-v-5035a7b5]{font-size:12px;color:#999}.sync-task .task-content[data-v-5035a7b5]{padding:20px 0 0 0}.sync-task .task-content .source-table[data-v-5035a7b5]{padding:0 0 20px 0;margin-top:20px}.sync-task .task-content .source-table .pagation[data-v-5035a7b5]{width:100%}.sync-task .task-content .data-origin[data-v-5035a7b5] .el-select{width:100%!important}.preview .table-num[data-v-5035a7b5]{margin:20px 0}.map-detail[data-v-5035a7b5]{color:#999;font-size:14px;margin:10px 40px;line-height:30px}.buttons[data-v-5035a7b5]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.sync-details[data-v-5035a7b5]{font-size:12px;padding:10px 0 10px 15px}.sync-details li[data-v-5035a7b5]{padding:5px 0}.sync-details li .label[data-v-5035a7b5]{color:#333;margin-right:10px}.sync-details li .value[data-v-5035a7b5]{font-size:12px;color:#666}",""])},"0a49":function(e,t,a){var r=a("9b43"),i=a("626a"),n=a("4bf8"),s=a("9def"),o=a("cd1c");e.exports=function(e,t){var a=1==e,l=2==e,c=3==e,u=4==e,d=6==e,f=5==e||d,p=t||o;return function(t,o,h){for(var m,b,g=n(t),v=i(g),y=r(o,h,3),S=s(v.length),w=0,x=a?p(t,S):l?p(t,0):void 0;S>w;w++)if((f||w in v)&&(b=y(m=v[w],w,g),e))if(a)x[w]=b;else if(b)switch(e){case 3:return!0;case 5:return m;case 6:return w;case 2:x.push(m)}else if(u)return!1;return d?-1:c||u?u:x}}},"20d6":function(e,t,a){"use strict";var r=a("5ca1"),i=a("0a49")(6),n="findIndex",s=!0;n in[]&&Array(1)[n]((function(){s=!1})),r(r.P+r.F*s,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(n)},"31a2":function(e,t,a){var r=a("05b6");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a("499e").default)("39ac8356",r,!0,{sourceMap:!1,shadowMode:!1})},"6c40":function(e,t,a){"use strict";a("cd5e")},"6cea":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.offline-sync .form .el-form-item{margin-bottom:0}",""])},7514:function(e,t,a){"use strict";var r=a("5ca1"),i=a("0a49")(5),n=!0;"find"in[]&&Array(1).find((function(){n=!1})),r(r.P+r.F*n,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("find")},"86b9":function(e,t,a){"use strict";a.d(t,"n",(function(){return c})),a.d(t,"g",(function(){return u})),a.d(t,"e",(function(){return d})),a.d(t,"d",(function(){return f})),a.d(t,"h",(function(){return p})),a.d(t,"a",(function(){return h})),a.d(t,"f",(function(){return m})),a.d(t,"m",(function(){return b})),a.d(t,"b",(function(){return g})),a.d(t,"q",(function(){return v})),a.d(t,"p",(function(){return y})),a.d(t,"o",(function(){return S})),a.d(t,"i",(function(){return w})),a.d(t,"k",(function(){return x})),a.d(t,"j",(function(){return k})),a.d(t,"l",(function(){return D})),a.d(t,"c",(function(){return L}));a("8e6e"),a("ac6a"),a("456d");var r=a("ade3"),i=a("2b0e"),n=a("fedb"),s=a("ca00");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c=function(e){return i.default.http.post(n.a.saveNodeData,e)},u=function(e){return i.default.http.get(n.a.getMetaDbListByConnect+"/".concat(e))},d=function(e){return i.default.http.get(n.a.getConfDbListByConnect+"/".concat(e))},f=function(e){return i.default.http.get(n.a.getConfConnectListAllKafka,{params:e})},p=function(e){return i.default.http.get(n.a.getNodeDetail,{params:e})},h=function(e){return i.default.http.post(n.a.deleteNodeConnect,e)},m=function(){return i.default.http.get(n.a.getFieldTypes)},b=function(e){return i.default.http.get(Object(s.e)(n.a.reviewSql,{id:e}))},g=function(){return i.default.http.get(n.a.downLoadFieldFile,{responseType:"arraybuffer"})},v=function(e){return i.default.http.post(n.a.uploadFieldFile,e)},y=function(e){return i.default.http.get(n.a.taskGetPartFields,{params:e})},S=function(e){return i.default.http.post(n.a.tableViewData,e)},w=function(e){return i.default.http.post(n.a.getProcInfoListDbs,l({},e))},x=function(e){return i.default.http.post(n.a.getRealTimeTableList,e)},k=function(e){var t=e.id;return i.default.http.get(n.a.getRealTimeDetail+"/".concat(t))},D=function(e){return i.default.http.post(n.a.getTableInfoListNew,e)},L=function(e){return i.default.http.get(n.a.getAllFields,{params:e})}},a1b0:function(e,t,a){"use strict";a.r(t);a("386d"),a("8e6e"),a("ac6a"),a("456d"),a("96cf");var r=a("1da1"),i=a("ade3"),n=(a("7514"),a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("c5f6"),a("7f7f"),a("20d6"),a("2909")),s=a("01ff"),o=a("86b9"),l=a("50f0");function c(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s=!0,o=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return s=e.done,e},e:function(e){o=!0,n=e},f:function(){try{s||null==a.return||a.return()}finally{if(o)throw n}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p,h,m,b,g,v,y,S,w,x={name:"SyncTask",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},editDetail:{type:Object,default:function(){return{}}}},components:{filterTBHeader:l.a},created:function(){this.dataSourceDetail=[]},data:function(){return{listId:[],tableLoading:!1,active:0,form1:{taskName:"",dataSourceType:null,dataSource:null,dataLibrary:null,tableName:""},form2:{toHiveDatabase:null,writeRule:null,storageFormat:null,initRole:null},form3:{syncMethod:1,tableExistRule:1,writeFlowControl:1,writeFlowControlNum:1234,concurrencyLimit:1,memorySize:1},mapSetForm:{tableMapping:"ods"},mapSetRules:{tableMapping:[{required:!0,message:"请输入表名映射",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]*$/,message:"只能输入英文，数字，下划线"}]},rules1:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"},{pattern:/^[\u4E00-\u9FA5a-zA-Z0-9_]*$/,message:"只能输入中英文，数字，下划线"}],dataSourceType:[{required:!0,message:"请选择数据来源",trigger:"change"}],dataSource:[{required:!0,message:"请选择数据源",trigger:"change"}],dataLibrary:[{required:!0,message:"请选择数据库",trigger:"change"}]},rules2:{toHiveDatabase:[{required:!0,message:"请选择去向hive库",trigger:"change"}],storageFormat:[{required:!0,message:"请选择存储格式",trigger:"change"}],initRole:[{required:!0,message:"请选择初始授权角色",trigger:"change"}]},rules3:{},dataOriginList:[{value:1,label:"mysql"},{value:2,label:"oracle"}],roleIdList:[],dataSourceList:[],dataSetList:[],hiveList:[],writeRuleList:[],storageList:[],sourceTableList:[],recordList:[],selectedDataArr:[],currentPage:1,currentSize:5,totalCount:0,maxSelectCount:20,mapSetVisible:!1,prefix:"ods",preMid:"",saveDisabled:!1}},computed:{dataToList:function(){var e=this,t=[];return this.selectedDataArr.forEach((function(a){t.push({tableName:a.previewTable,toHiveDatabase:e.form2.toHiveDatabase})})),t}},methods:{serch:function(e){this.currentPage=1,this.form1.tableName=e,this.getSyncTableListByDataBase()},selectChange:function(e,t){if(e.length>this.selectedDataArr.length&&this.selectedDataArr.length===this.maxSelectCount)return this.$message.warning("当前最多选择".concat(this.maxSelectCount,"条数据！")),this.$refs.sourceTable.toggleRowSelection(t,!1),void(this.selectedDataArr=this.selectedDataArr.filter((function(e){return e.id!==t.id})));this.selectedDataArr=Object(n.a)(e)},selectAll:function(e){var t=this;if(e.length>this.maxSelectCount){this.$message.warning("当前最多选择".concat(this.maxSelectCount,"条数据，已自动去除多余的数据！"));var a=e.filter((function(e){return-1===t.selectedDataArr.findIndex((function(t){return t.id===e.id}))}));a.splice(this.maxSelectCount-this.selectedDataArr.length,e.length-this.maxSelectCount).forEach((function(e){t.$refs.sourceTable.toggleRowSelection(e,!1)}));var r=a.splice(0,this.maxSelectCount-this.selectedDataArr.length);this.selectedDataArr=[].concat(Object(n.a)(r),Object(n.a)(this.selectedDataArr))}else this.selectedDataArr=Object(n.a)(e)},handleSelectable:function(e,t){return 2!==e.checkResult},handleSyncDialogClose:function(){var e=this;this.active=0,this.sourceTableList=[],this.selectedDataArr=[],this.dataSourceList=[],this.dataSetList=[],this.recordList=[],this.currentPage=1,this.currentSize=5,this.totalCount=0,this.$nextTick((function(){e.refreshRowSelection()})),this.$refs.sourceTable.clearSelection(),this.$refs.syncForm1.resetFields(),this.$refs.form2.resetFields(),this.$refs.form3.resetFields(),this.form1=this.$options.data().form1,this.$router.push("/dataAggregation/offLineSync"),this.$emit("close"),this.$emit("refresh"),this.mapSetForm=this.$options.data().mapSetForm},handleMapSetClose:function(){this.$refs.mapSetForm.clearValidate(),this.mapSetVisible=!1},addTotalSync:(w=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.saveDisabled=!0,e.prev=1,e.next=4,Object(s.a)(f(f(f({},this.form1),{},{tableMapping:this.prefix,recordList:this.selectedDataArr.map((function(e){return{originTable:e.sourceTable,previewTable:e.previewTable,tableId:e.id,dataTableSource:e.dataTableSource}}))},this.form2),this.form3));case 4:0===e.sent.data.code&&(this.$emit("close"),this.$message.success("保存成功"));case 7:return e.prev=7,this.clearSelect(),this.saveDisabled=!1,e.finish(7);case 11:case"end":return e.stop()}}),e,this,[[1,,7,11]])}))),function(){return w.apply(this,arguments)}),clearSelect:function(){var e=this;this.selectedDataArr.forEach((function(t){e.$refs.sourceTable.toggleRowSelection(t,!1)})),this.selectedDataArr=[]},editSync:(S=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.saveDisabled=!0,e.prev=1,this.form1.sourceId=this.form1.dataSource,e.next=5,Object(s.c)(f(f(f({id:this.editDetailData.id},this.form1),{},{tableMapping:this.prefix,recordList:this.selectedDataArr.map((function(e){return{originTable:e.sourceTable,previewTable:e.previewTable,tableId:e.id,dataTableSource:e.dataTableSource}}))},this.form2),this.form3));case 5:0===e.sent.data.code&&(this.$emit("close"),this.$message.success("保存成功"));case 8:return e.prev=8,this.clearSelect(),this.saveDisabled=!1,e.finish(8);case 12:case"end":return e.stop()}}),e,this,[[1,,8,12]])}))),function(){return S.apply(this,arguments)}),handleMapSetSure:function(){var e=this;this.$refs.mapSetForm.validate((function(t){if(!t)return!1;e.prefix=e.preMid,e.$nextTick((function(){if(e.selectedDataArr.length>0){var t,a=c(e.selectedDataArr);try{for(a.s();!(t=a.n()).done;){var r=t.value;r.sourceTable=r.sourceTable?r.sourceTable:r.originTable,r.previewTable=e.prefix+(e.prefix?"_":"")+r.sourceTable}}catch(e){a.e(e)}finally{a.f()}}else e.$message.error("至少选择一张表")})),e.mapSetVisible=!1}))},prevStep:function(){this.active--},nextStep:function(){var e=this;0===this.active?this.$refs.syncForm1.validate((function(t){if(!t)return!1;if(e.selectedDataArr.length>0){e.active++;var a,r=c(e.selectedDataArr);try{for(r.s();!(a=r.n()).done;){var i=a.value;i.sourceTable=i.sourceTable?i.sourceTable:i.originTable,i.previewTable=e.prefix+(e.prefix?"_":"")+i.sourceTable}}catch(e){r.e(e)}finally{r.f()}}else e.$message.error("至少选择一张表")})):1===this.active?this.$refs.form2.validate((function(t){if(!t)return!1;e.active++})):2===this.active&&this.$refs.form3.validate((function(t){if(!t)return!1;e.active++}))},handleCancel:function(){this.$emit("close")},handleSure:function(){this.isEdit?this.editSync():this.addTotalSync()},handleSizeChange:function(e){this.currentSize=e,this.getSyncTableListByDataBase()},handleCurrentChange:function(e){this.currentPage=e,this.getSyncTableListByDataBase()},refreshRowSelection:function(){this.$refs.sourceTable.clearSelection(),this.selectedDataArr=[]},handlePrefixChange:function(e){this.preMid=e},initSyncDetailList:(y=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a,r,i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.g)({typeId:this.form1.dataSourceType,limit:1e4});case 2:t=e.sent,a=t.data,r=a.code,i=a.page,0===r&&(this.dataSourceDetail=i.list,this.dataSourceList=[],i.list.length>0&&i.list.forEach((function(e){n.dataSourceList.push({label:e.name,value:e.id})})),this.handleDataSourceChange(this.form1.dataSource,!0,!0),null!==this.editDetail&&this.editDetail.recordList.length&&(this.selectedDataArr=this.editDetailData.recordList.map((function(e){return e.id=e.tableId,e}))),this.$nextTick((function(){n.selectedDataArr.forEach((function(e){n.$refs.sourceTable.toggleRowSelection(e,!0)}))})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)}),getSyncTableListByDataBase:(v=Object(r.a)(regeneratorRuntime.mark((function e(t){var a,r,i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tableLoading=!0,e.next=3,Object(s.k)({typeId:this.form1.dataSourceType,connectId:this.form1.dataSource,tableName:this.form1.tableName,dbName:this.form1.dataLibrary,page:this.currentPage,limit:this.currentSize});case 3:a=e.sent,r=a.data,i=r.data,0===r.code&&(this.sourceTableList=i.list.map((function(e){return{sourceTable:e}})),null!==this.editDetail&&this.editDetail.recordList.length&&1==this.editDetail.recordList[0].dataTableSource?(this.recordList=this.editDetail.recordList.map((function(e){return{id:e.id,sourceTable:e.originTable,previewTable:e.previewTable,compareResult:"已是最新元数据"}})),this.currentPage=1,this.currentSize=5,this.totalCount=1):null!==this.editDetail&&this.editDetail.recordList.length?(this.listId=[],this.editDetail.recordList.map((function(e){n.listId.push(e.id)})),this.recordList=this.sourceTableList.map((function(e){return{sourceTable:e.sourceTable.tableName,previewTable:n.prefix+(n.prefix?"_":"")+e.sourceTable.tableName,checkResult:e.sourceTable.status,compareResult:e.sourceTable.compareResult,id:e.sourceTable.id}})),this.recordList.forEach((function(e){n.listId.forEach((function(t){e.id===t&&n.$nextTick((function(){n.$refs.sourceTable.toggleRowSelection(e,!0)}))}))})),this.currentSize=5,this.totalCount=i.totalCount):(this.editDetail,this.recordList=this.sourceTableList.map((function(e){return{sourceTable:e.sourceTable.tableName,previewTable:n.prefix+(n.prefix?"_":"")+e.sourceTable.tableName,checkResult:e.sourceTable.status,compareResult:e.sourceTable.compareResult,id:e.sourceTable.id}})),this.totalCount=i.totalCount),t&&t()),this.tableLoading=!1;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)}),getSyncHiveList:(g=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.f)();case 2:t=e.sent,a=t.data,r=a.data,0===a.code&&(this.hiveList=[],r.forEach((function(e){i.hiveList.push({label:e.name,value:e.name}),e.isDefault&&(i.form2.toHiveDatabase=e.name)})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)}),getSyncWriteRuleList:(b=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a,r,i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.l)();case 2:t=e.sent,a=t.data,r=a.code,i=a.data,0===r&&(this.writeRuleList=[],i.forEach((function(e){n.writeRuleList.push({label:e.name,value:e.name}),e.isDefault&&(n.form2.writeRule=e.name)})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)}),getSyncStorageFormatList:(m=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a,r,i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.j)();case 2:t=e.sent,a=t.data,r=a.code,i=a.data,0===r&&(this.storageList=[],i.forEach((function(e){n.storageList.push({label:e.name,value:e.name}),e.isDefault&&(n.form2.storageFormat=e.name)})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)}),handleDialogOpen:function(){var e=this;if(this.isEdit){this.recordList=[];var t=this.editDetailData,a=t.taskName,r=t.dataSourceType,i=t.dataSource,s=t.dataLibrary,o=t.sourceId,l=t.recordList,c=this.editDetailData,u=c.toHiveDatabase,d=c.writeRule,f=c.storageFormat,p=c.initRole,h=this.editDetailData,m=h.syncMethod,b=h.tableExistRule,g=h.writeFlowControl,v=h.writeFlowControlNum,y=h.concurrencyLimit,S=h.memorySize;r="MySQL"===r?1:2,i=parseInt(i),this.form1={taskName:a,dataSourceType:r,dataSource:i,dataLibrary:s},this.form2={toHiveDatabase:u,writeRule:d,storageFormat:f,initRole:p},this.form3={syncMethod:m,tableExistRule:b,writeFlowControl:g,writeFlowControlNum:v,concurrencyLimit:y,memorySize:S},this.form1.dataSource=o,this.initSyncDetailList(),this.editDetailData.recordList[0].dataTableSource?(this.recordList.push({dataTableSource:l[0].tableId,id:l[0].tableId,sourceTable:l[0].originTable,previewTable:l[0].previewTable,compareResult:"已是最新元数据"}),this.selectedDataArr=Object(n.a)(this.recordList),this.$nextTick((function(){e.selectedDataArr.forEach((function(t){e.$refs.sourceTable.toggleRowSelection(t,!0)}))})),this.totalCount=1):this.getSyncTableListByDataBase()}else this.preMid="ods",this.prefix="ods"},handledataSourceTypeChange:(h=Object(r.a)(regeneratorRuntime.mark((function e(t){var a,r,i,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return this.sourceTableList=[],e.next=5,Object(s.g)({typeId:this.form1.dataSourceType,limit:1e4});case 5:a=e.sent,r=a.data,i=r.code,n=r.page,0===i&&(this.dataSourceList=[],this.dataSetList=[],this.form1.dataSource="",this.form1.dataLibrary="",n.list.length>0&&n.list.forEach((function(e){o.dataSourceList.push({label:e.name,value:e.id})})));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)}),handleDataSourceChange:function(e,t,a){var i=this;e&&Object(r.a)(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(o.g)(e);case 3:n=r.sent,s=n.data.data,i.dataSetList=s.map((function(e){return{label:e,value:e}})),a||(i.$refs.sourceTable.clearSelection(),i.selectedDataArr=[]),i.dataSetList.length>0?i.$nextTick((function(){t||(i.form1.dataLibrary=i.dataSetList[0].value,i.handleDataLibrary(i.form1.dataLibrary))})):i.handleDataLibrary(),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0);case 13:case"end":return r.stop()}}),r,null,[[0,10]])})))()},handleDataLibrary:function(e){this.currentPage=1,this.form1.tableName="",this.getSyncTableListByDataBase()},handleMapSetOpen:function(){this.mapSetForm.tableMapping="ods",this.preMid="ods"},getRoleSelectNew:(p=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a,r,i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.d)();case 2:t=e.sent,a=t.data,r=a.code,i=a.data,0===r&&(this.roleIdList=[],i.forEach((function(e){n.roleIdList.push({label:e.roleName,value:e.roleId})})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},mounted:function(){var e=this;this.getRoleSelectNew(),this.getSyncHiveList(),this.getSyncWriteRuleList(),this.getSyncStorageFormatList();var t=this.$route.query;if(t.isRick){this.recordList=[];var a=JSON.parse(sessionStorage.getItem("isRickInfo")),r=a.dbName,i=a.tableName,s=a.sourceId,o=a.projectName,l=a.id;this.form1.dataSourceType=Number(t.databaseType),this.form1.dataLibrary=r,this.form1.tableName=i,this.form1.dataSource=s,this.form1.taskName="".concat(o,"_").concat("1"==t.databaseType?"mysql":"oracle","_").concat(r,"_").concat(i,"初始化入湖任务"),this.initSyncDetailList(),this.recordList.push({dataTableSource:l,id:l,sourceTable:i,previewTable:i,compareResult:"已是最新元数据"}),this.selectedDataArr=Object(n.a)(this.recordList),this.$nextTick((function(){e.selectedDataArr.forEach((function(t){e.$refs.sourceTable.toggleRowSelection(t,!0)}))})),this.totalCount=1}},watch:{currentPage:function(){this.$nextTick((function(){}))},currentSize:function(){this.$nextTick((function(){}))},editDetail:{handler:function(e){this.editDetailData=e},deep:!0}}},k=(a("ef76"),a("2877")),D=Object(k.a)(x,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"sync-task"},[t("el-dialog",{attrs:{title:e.isEdit?"编辑整库同步任务":"新建整库同步任务",visible:e.visible,width:"60%"},on:{close:e.handleSyncDialogClose,open:e.handleDialogOpen}},[t("el-steps",{attrs:{active:e.active,"finish-status":"success"}},[t("el-step",{attrs:{title:"数据来源配置"}}),t("el-step",{attrs:{title:"数据去向配置"}}),t("el-step",{attrs:{title:"数据同步配置"}}),t("el-step",{attrs:{title:"预览"}})],1),t("el-alert",{staticClass:"detail",attrs:{title:"默认以及建议使用parquet格式，如果选择text格式，请确保数据里不包含\\n换行符，含有&号的数据请勿使用默认列分隔符，\n        否则同步的数据将会错乱。",type:"info","close-text":"知道了"}}),t("div",{staticClass:"task-content"},[t("el-form",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],ref:"syncForm1",attrs:{model:e.form1,"label-width":"120px",rules:e.rules1,size:"mini","label-position":"left"}},[t("el-form-item",{attrs:{label:"任务名称:",prop:"taskName"}},[t("el-input",{attrs:{placeholder:"支持中英文，数字，下划线组合"},model:{value:e.form1.taskName,callback:function(t){e.$set(e.form1,"taskName",t)},expression:"form1.taskName"}})],1),t("el-form-item",{staticClass:"data-origin",attrs:{label:"数据来源:",prop:"dataSourceType"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.handledataSourceTypeChange},model:{value:e.form1.dataSourceType,callback:function(t){e.$set(e.form1,"dataSourceType",t)},expression:"form1.dataSourceType"}},e._l(e.dataOriginList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"data-source",attrs:{label:"数据源:",required:""}},[t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{attrs:{span:11}},[t("div",{staticStyle:{display:"flex"}},[t("el-form-item",{staticClass:"data-origin",staticStyle:{flex:"1"},attrs:{prop:"dataSource",required:""}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择数据源"},on:{change:e.handleDataSourceChange},model:{value:e.form1.dataSource,callback:function(t){e.$set(e.form1,"dataSource",t)},expression:"form1.dataSource"}},e._l(e.dataSourceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"支持的数据源类型：MySQL、Oracle",placement:"top-start"}},[t("i",{staticClass:"icon icon-ic_remind",staticStyle:{"margin-left":"10px"}})])],1)]),t("el-col",{attrs:{span:11}},[t("el-form-item",{staticClass:"data-origin",attrs:{prop:"dataLibrary"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择数据库"},on:{change:e.handleDataLibrary},model:{value:e.form1.dataLibrary,callback:function(t){e.$set(e.form1,"dataLibrary",t)},expression:"form1.dataLibrary"}},e._l(e.dataSetList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)],1),t("el-form-item",{attrs:{label:"来源表:",required:""}},[t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{attrs:{span:18}},[t("el-button",{on:{click:e.refreshRowSelection}},[e._v("取消所有选中的表"+e._s(e.selectedDataArr.length?"(".concat(e.selectedDataArr.length,"/").concat(e.maxSelectCount,")"):""))])],1),t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.mapSetVisible=!0}}},[e._v("配置映射")])],1)],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],staticClass:"source-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"sourceTable",attrs:{data:e.recordList,"max-height":"250","tooltip-effect":"dark","row-key":"id"},on:{"select-all":e.selectAll,select:e.selectChange}},[t("el-table-column",{attrs:{type:"selection",selectable:e.handleSelectable,"reserve-selection":!0,fixed:"left",width:"55"}}),t("el-table-column",{attrs:{prop:"sourceTable","show-overflow-tooltip":""},scopedSlots:e._u([{key:"header",fn:function(a){return[t("filter-t-b-header",{attrs:{label:"源表名",type:"serch",value:e.form1.tableName,serchPlaceholder:"请输入表名进行搜索"},on:{"update:value":function(t){return e.$set(e.form1,"tableName",t)},comfirm:e.serch}})]}}])}),t("el-table-column",{attrs:{label:"预生产表名",prop:"previewTable","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"检测结果",prop:"compareResult","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.compareResult))])]}}])})],1),t("div",{staticClass:"pagation"},[t("el-pagination",{attrs:{"current-page":e.currentPage,small:"","page-sizes":[5,10,20,50],"page-size":e.currentSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),t("el-form",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}],ref:"form2",attrs:{model:e.form2,rules:e.rules2,"label-width":"120px","label-position":"left"}},[t("el-form-item",{staticClass:"data-origin",attrs:{label:"去向hive库:",prop:"toHiveDatabase",required:""}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.form2.toHiveDatabase,callback:function(t){e.$set(e.form2,"toHiveDatabase",t)},expression:"form2.toHiveDatabase"}},e._l(e.hiveList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"data-origin",attrs:{label:"存储格式:",prop:"storageFormat"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.form2.storageFormat,callback:function(t){e.$set(e.form2,"storageFormat",t)},expression:"form2.storageFormat"}},e._l(e.storageList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"data-origin",attrs:{label:"初始授权角色:",prop:"initRole"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择初始授权角色"},model:{value:e.form2.initRole,callback:function(t){e.$set(e.form2,"initRole",t)},expression:"form2.initRole"}},e._l(e.roleIdList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-form",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active === 2"}],ref:"form3",attrs:{model:e.form3,rules:e.rules3,"label-width":"180px","label-position":"left"}},[t("el-form-item",{attrs:{label:"同步方式:",prop:"syncMethod"}},[t("el-radio-group",{model:{value:e.form3.syncMethod,callback:function(t){e.$set(e.form3,"syncMethod",t)},expression:"form3.syncMethod"}},[t("el-radio-button",{attrs:{label:1}},[e._v("仅同步表结构")]),t("el-radio-button",{attrs:{label:2}},[e._v("同步表结构和表数据")])],1)],1),t("el-form-item",{attrs:{label:"表存在性检测:",prop:"tableExistRule"}},[t("el-checkbox",{attrs:{"true-label":1,"false-label":2},model:{value:e.form3.tableExistRule,callback:function(t){e.$set(e.form3,"tableExistRule",t)},expression:"form3.tableExistRule"}},[e._v("若目标表存在，则不进行整库同步")])],1),t("el-form-item",{attrs:{label:"写入流量控制:"}},[t("el-row",{attrs:{type:"flex",justify:"flex-start"}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{prop:"writeFlowControl"}},[t("el-switch",{attrs:{"active-text":"限速","inactive-text":"不限速","active-value":2,"inactive-value":1},model:{value:e.form3.writeFlowControl,callback:function(t){e.$set(e.form3,"writeFlowControl",t)},expression:"form3.writeFlowControl"}})],1)],1),t("el-col",{directives:[{name:"show",rawName:"v-show",value:2===e.form3.writeFlowControl,expression:"form3.writeFlowControl === 2"}],attrs:{span:2}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"当限流超出最大值，则限流会默认为流量的最大值99999",placement:"top-start"}},[t("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"}})])],1),t("el-col",{directives:[{name:"show",rawName:"v-show",value:2===e.form3.writeFlowControl,expression:"form3.writeFlowControl === 2"}],attrs:{span:8}},[t("el-form-item",{attrs:{prop:"writeFlowControlNum"}},[t("el-input-number",{attrs:{precision:0,"controls-position":"right",min:0,max:99999},model:{value:e.form3.writeFlowControlNum,callback:function(t){e.$set(e.form3,"writeFlowControlNum",t)},expression:"form3.writeFlowControlNum"}}),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("条/s")])],1)],1)],1)],1),t("el-form-item",{attrs:{label:"并发限制:",prop:"concurrencyLimit"}},[t("el-input-number",{attrs:{precision:0,"controls-position":"right",min:1},model:{value:e.form3.concurrencyLimit,callback:function(t){e.$set(e.form3,"concurrencyLimit",t)},expression:"form3.concurrencyLimit"}}),t("span",{staticStyle:{"padding-left":"10px",color:"rgba(4,12,44,0.65)"}},[e._v("说明：对于每张源表，并发配置生效的前提是该表设有主键且类型为整型。")])],1),t("el-form-item",{attrs:{label:"内存:",prop:"memorySize"}},[t("el-input-number",{attrs:{precision:0,"controls-position":"right",min:1},model:{value:e.form3.memorySize,callback:function(t){e.$set(e.form3,"memorySize",t)},expression:"form3.memorySize"}}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("G")])],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:3===e.active,expression:"active === 3"}],staticClass:"preview"},[t("div",{staticClass:"info"},[e._v("提示：创建完数据同步任务后，需要在数据同步任务列表中点击同步。")]),t("div",{staticClass:"tables"},[t("div",{staticClass:"table-num"},[e._v("已选表： 共"+e._s(e.selectedDataArr.length)+"张表")]),t("el-row",{attrs:{type:"flex",justify:"space-around"}},[t("el-col",{attrs:{span:12}},[t("el-table",{attrs:{data:e.selectedDataArr,"max-height":"200"}},[t("el-table-column",{attrs:{prop:"sourceTable",label:"表名","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"previewTable",label:"预生成表","show-overflow-tooltip":""}})],1)],1),t("el-col",{attrs:{span:11}},[t("el-table",{attrs:{data:e.dataToList,"max-height":"200"}},[t("el-table-column",{attrs:{prop:"tableName",label:"入库表名","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"toHiveDatabase",label:"数据去向库","show-overflow-tooltip":""}})],1)],1)],1),t("ul",{staticClass:"sync-details"},[t("li",[t("span",{staticClass:"label"},[e._v("去向库：")]),t("span",{staticClass:"value"},[e._v(e._s(e.form2.toHiveDatabase))])]),t("li",[t("span",{staticClass:"label"},[e._v("存储格式：")]),e.storageList.length>0?t("span",{staticClass:"value"},[e._v(e._s(e.storageList.find((function(t){return t.value===e.form2.storageFormat}))?e.storageList.find((function(t){return t.value===e.form2.storageFormat})).label:""))]):e._e()]),t("li",[t("span",{staticClass:"label"},[e._v("初始授权角色：")]),e.roleIdList.length>0?t("span",{staticClass:"value"},[e._v(e._s(e.roleIdList.find((function(t){return t.value==e.form2.initRole}))?e.roleIdList.find((function(t){return t.value==e.form2.initRole})).label:""))]):e._e()]),t("li",[t("span",{staticClass:"label"},[e._v("写入流量控制：")]),2===e.form3.writeFlowControl?t("span",{staticClass:"value"},[e._v("限速 "+e._s(e.form3.writeFlowControlNum)+" 条/s")]):t("span",[e._v("不限速")])]),t("li",[t("span",{staticClass:"label"},[e._v("同步方式：")]),t("span",{staticClass:"value"},[e._v("\n                "+e._s(1===this.form3.syncMethod?"仅同步表结构":"同步表结构和表数据")+"\n              ")])]),t("li",[t("span",{staticClass:"label"},[e._v("表存在性检测：\n                ")]),t("span",{staticClass:"value"},[t("el-checkbox",{attrs:{disabled:"","true-label":1,"false-label":2},model:{value:e.form3.tableExistRule,callback:function(t){e.$set(e.form3,"tableExistRule",t)},expression:"form3.tableExistRule"}},[e._v("若目标表存在，则不进行整库同步")])],1)]),t("li",[t("span",{staticClass:"label"},[e._v("并发限制：")]),t("span",{staticClass:"value"},[e._v(e._s(e.form3.concurrencyLimit))])])])],1)])],1),t("div",{staticClass:"buttons",attrs:{slot:"footer"},slot:"footer"},[0!==e.active?t("el-button",{on:{click:e.prevStep}},[e._v("上一步")]):e._e(),3!==e.active?t("el-button",{attrs:{type:"primary"},on:{click:e.nextStep}},[e._v("下一步")]):e._e(),3===e.active?t("el-button",{attrs:{type:"primary",loading:e.saveDisabled},on:{click:e.handleSure}},[e._v("确定")]):e._e(),3===e.active?t("el-button",{on:{click:e.handleCancel}},[e._v("取消")]):e._e()],1)],1),t("el-dialog",{attrs:{title:"映射配置",visible:e.mapSetVisible,top:"30vh",width:"35%","append-to-body":""},on:{"update:visible":function(t){e.mapSetVisible=t},close:e.handleMapSetClose}},[t("el-form",{ref:"mapSetForm",attrs:{model:e.mapSetForm,"label-width":"120px",rules:e.mapSetRules,size:"mini","label-position":"left"}},[t("el-row",{attrs:{type:"flex",justify:"flex-start"}},[t("el-col",{attrs:{span:14}},[t("el-form-item",{attrs:{label:"表名映射:",prop:"tableMapping"}},[t("el-input",{attrs:{placeholder:"ods，默认前缀ods,可输入"},on:{change:e.handlePrefixChange},model:{value:e.mapSetForm.tableMapping,callback:function(t){e.$set(e.mapSetForm,"tableMapping",t)},expression:"mapSetForm.tableMapping"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"","label-width":"20px"}},[t("el-input",{attrs:{disabled:"",placeholder:"_${表名}"}})],1)],1)],1),t("div",{staticClass:"map-detail"},[e._v("eg：数据源mysql 库test中的2张表test1，test2;配置好表名映射的前缀为ods，映射后的效果为ods_test1,ods_test2")]),t("div",{staticClass:"buttons"},[t("el-button",{on:{click:e.handleMapSetClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleMapSetSure}},[e._v("确定")])],1)],1)],1)],1)}),[],!1,null,"5035a7b5",null).exports,L=a("2f62");function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var _,O,R,j,$,N={name:"OffLineSync",data:function(){return{taskName:"",searchUserId:null,createUserList:[],taskStatus:"",tableData:[],currentPage:1,currentSize:10,total:null,taskProgressSort:null,multiSelections:[],syncDialog:!1,form:{task:null},taskList:[],rules:{task:{required:!0,message:"请选择任务队列",trigger:"change"}},syncTaskVisible:!1,isEdit:!1,editDetail:null,syncDetail:null,loading:!0,syncDisabled:!1,statusList:[{text:"未开始",value:0},{text:"进行中",value:1},{text:"成功",value:2},{text:"失败",value:3},{text:"中止",value:4}]}},computed:C({},Object(L.c)("old",["admin_info"])),methods:{getRealtimequeue:function(){var e=this;this.$API.post(this.$URL.getRealtimequeue,{limit:999,page:1,queueName:""},(function(t){0==t.code?e.taskList=t.page.list:e.$message.error(t.msg)}))},getCreateUserList:function(){var e=this;this.$API.get(this.$URL.getSyncCreateUserList,{},(function(t){0==t.code?e.createUserList=t.data:e.$message.error(t.msg)}))},goDetail:function(e){this.$router.push("/offLineSyncDetail?id=".concat(e.id))},reset:function(){this.taskName="",this.searchUserId=null,this.search()},handleSelectionChange:function(e){this.multiSelections=e.map((function(e){return e.id}))},handleSizeChange:function(e){this.currentSize=e,this.getSyncPageList()},handleCurrentChange:function(e){this.currentPage=e,this.getSyncPageList()},handleSortChange:function(e){"createTime"===e.prop&&(this.taskProgressSort=e.order?{ascending:"asc",descending:"desc"}[e.order]:null),this.getSyncPageList()},filterHandler:function(e,t,a){return t[a.property]===e},handleSync:function(e){this.syncDialog=!0,this.syncDetail=e},tableOrDataSync:($=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncDisabled=!0,e.prev=1,e.next=4,Object(s.m)({id:this.syncDetail.id,syncQueue:this.form.task});case 4:0===e.sent.data.code&&(this.$message.success("任务已提交！"),this.getSyncPageList(),this.syncDialog=!1);case 7:return e.prev=7,this.syncDisabled=!1,this.syncDialog=!1,e.finish(7);case 11:case"end":return e.stop()}}),e,this,[[1,,7,11]])}))),function(){return $.apply(this,arguments)}),handleSyncSure:function(){var e=this;this.$refs.syncForm.validate((function(t){if(!t)return!1;e.tableOrDataSync()}))},handleSyncDialogClose:function(){var e=this;this.$refs.syncForm.resetFields(),this.$nextTick((function(){e.syncDialog=!1}))},getSyncLogInfo:(j=Object(r.a)(regeneratorRuntime.mark((function e(t){var a,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.h)({id:t});case 2:a=e.sent,r=a.data,i=r.data,0===r.code&&(localStorage.SyncLog=JSON.stringify(i),this.$router.push("/offLineSyncLog"));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)}),goToLog:function(e){this.getSyncLogInfo(e.id)},newTask:function(){this.isEdit=!1,this.syncTaskVisible=!0},handleSyncTaskClose:function(){this.syncTaskVisible=!1,this.editDetail=null},handleEdit:function(e){this.getSyncDetail(e)},handleDeleteSync:function(e){var t=this;this.$confirm("你确定要删除整库同步任务吗?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteSync({ids:[e.id]})})).catch((function(){}))},getSyncPageList:(R=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,Object(s.i)({taskName:this.taskName,searchUserId:this.searchUserId,taskStatus:this.taskStatus,current:this.currentPage,size:this.currentSize,sort:this.taskProgressSort});case 3:t=e.sent,this.loading=!1,this.tableData=t.data.page.records.map((function(e){return C(C({},e),{},{dataSourceType:e.dataSourceType&&e.dataSourceType.toLocaleLowerCase()})})),this.total=t.data.page.total,this.multiSelections=[];case 8:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)}),handleRefresh:function(){this.getSyncPageList()},getSyncDetail:(O=Object(r.a)(regeneratorRuntime.mark((function e(t){var a,r,i,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,e.next=4,Object(s.e)({id:a});case 4:r=e.sent,i=r.data,n=i.code,o=i.data,this.editDetail=null,0===n&&(this.editDetail=o,this.isEdit=!0,this.syncTaskVisible=!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)}),deleteSync:(_=Object(r.a)(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.ids,e.next=3,Object(s.b)({ids:a});case 3:0===e.sent.data.code&&(this.getSyncPageList(),this.$refs.multipleTable.clearSelection(),this.$message.success("删除成功"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)}),deletes:function(){var e=this;this.multiSelections.length&&this.$confirm("你确定要删除整库同步任务吗?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.deleteSync({ids:e.multiSelections})})).catch((function(){}))},search:function(){this.currentPage=1,this.getSyncPageList()},handleSelectable:function(e){return e.createName===this.admin_info.userName}},mounted:function(){var e=this.$route.query;e.isRick&&(this.syncTaskVisible=Boolean(e.isRick)),this.getCreateUserList(),this.getSyncPageList(),this.getRealtimequeue(),this.$refs.multipleTable.doLayout()},components:{SyncTask:D,filterTBHeader:l.a}},F=(a("bed7"),a("6c40"),Object(k.a)(N,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"offline-sync"},[t("h4",{staticClass:"title"},[e._v("离线同步")]),t("span",{staticClass:"info"},[e._v("整库同步建议做迁移和元数据表入湖使用，若需要实时同步或调度同步请在作业流或实时任务中创建同步任务")]),t("div",{staticClass:"offline-top"},[t("div",[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"store_sync_add",expression:"'store_sync_add'"}],attrs:{type:"primary"},on:{click:e.newTask}},[e._v("新建整库同步任务")]),t("el-button",{attrs:{disabled:0===e.multiSelections.length},on:{click:e.deletes}},[e._v("批量删除")])],1),t("div",[t("el-form",{staticClass:"form",attrs:{inline:!0}},[t("el-form-item",[t("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择任务创建人"},model:{value:e.searchUserId,callback:function(t){e.searchUserId=t},expression:"searchUserId"}},e._l(e.createUserList,(function(e){return t("el-option",{key:e.userId,attrs:{label:e.userName,value:e.userId}})})),1)],1),t("el-form-item",[t("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.taskName,callback:function(t){e.taskName="string"==typeof t?t.trim():t},expression:"taskName"}})],1),t("el-form-item",[t("el-button",{staticClass:"btn-search",attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")])],1),t("el-form-item",{staticStyle:{"margin-right":"0"}},[t("el-button",{staticClass:"btn-search",on:{click:e.reset}},[e._v("重置")])],1)],1),t("div")],1)]),t("div",{staticClass:"offline-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{data:e.tableData,"max-height":"550"},on:{"selection-change":e.handleSelectionChange,"sort-change":e.handleSortChange}},[t("el-table-column",{attrs:{selectable:e.handleSelectable,type:"selection",fixed:"left",width:"55"}}),t("el-table-column",{attrs:{fixed:"left",label:"任务ID",width:"100",prop:"id","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"taskName",label:"任务名称",fixed:"left","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.goDetail(r)}}},[e._v(e._s(r.taskName))])]}}])}),t("el-table-column",{attrs:{prop:"taskStatus",fixed:"left",width:"120"},scopedSlots:e._u([{key:"header",fn:function(a){return[t("filter-t-b-header",{attrs:{label:"任务状态",filter:e.statusList,value:e.taskStatus},on:{"update:value":function(t){e.taskStatus=t},comfirm:e.search}})]}},{key:"default",fn:function(a){var r=a.row;return[t("span",{class:["dot",0===r.taskStatus?"undone":1===r.taskStatus?"doing":2===r.taskStatus?"success":3===r.taskStatus?"error":"stop"]}),e._v("\n            "+e._s(0===r.taskStatus?"未开始":1===r.taskStatus?"进行中":2===r.taskStatus?"成功":3===r.taskStatus?"失败":"中止")+"\n          ")]}}])}),t("el-table-column",{attrs:{prop:"dataSourceType",label:"数据来源类型",width:"120",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n            "+e._s(a.dataSourceType)+"\n          ")]}}])}),t("el-table-column",{attrs:{prop:"toHiveDatabase",label:"数据去向信息",width:"120"}}),t("el-table-column",{attrs:{prop:"createName",label:"创建人","show-overflow-tooltip":"",width:"100"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",sortable:"custom","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"updateTime",label:"结束时间",sortable:"custom","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",fixed:"right",align:"right",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("div",{staticClass:"operator"},[t("button",{staticClass:"sync",attrs:{disabled:0!==r.taskStatus||e.admin_info.userName!==r.createName,type:"text"},on:{click:function(t){return e.handleSync(r)}}},[e._v("同步")]),t("el-button",{staticClass:"edit",attrs:{disabled:0!==r.taskStatus||e.admin_info.userName!==r.createName,type:"text"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]),t("el-button",{staticClass:"delete",attrs:{disabled:1===r.taskStatus||e.admin_info.userName!==r.createName,type:"text"},on:{click:function(t){return e.handleDeleteSync(r)}}},[e._v("删除")]),t("el-button",{staticClass:"log",attrs:{type:"text"},on:{click:function(t){return e.goToLog(r)}}},[e._v("日志")])],1)]}}])})],1)],1),t("div",{staticClass:"pagation"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.currentSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"同步",visible:e.syncDialog},on:{close:e.handleSyncDialogClose}},[t("el-form",{ref:"syncForm",attrs:{model:e.form,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"任务名称:"}},[t("span",[e._v(e._s(e.syncDetail&&e.syncDetail.taskName))])]),t("el-form-item",{attrs:{label:"任务队列:",prop:"task",required:""}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.form.task,callback:function(t){e.$set(e.form,"task",t)},expression:"form.task"}},e._l(e.taskList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.queueName,value:e.queueName}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.syncDialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.syncDisabled},on:{click:e.handleSyncSure}},[e._v("确 定")])],1)],1),t("sync-task",{attrs:{isEdit:e.isEdit,visible:e.syncTaskVisible,editDetail:e.editDetail},on:{close:e.handleSyncTaskClose,refresh:e.handleRefresh}})],1)}),[],!1,null,"762936ed",null));t.default=F.exports},bed7:function(e,t,a){"use strict";a("e6af")},c364:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".primary-color[data-v-762936ed]{color:#1740dc}.success-color[data-v-762936ed]{color:#52c41a}.warning-color[data-v-762936ed]{color:#faad14}.error-color[data-v-762936ed]{color:#f5222d}.info-color[data-v-762936ed]{color:#909399}.border-color[data-v-762936ed]{border:1px solid #e5e6e9}.offline-sync[data-v-762936ed]{width:100%;padding:0 15px}.offline-sync h4.title[data-v-762936ed]{font-weight:500px;font-size:16px;color:#040c2c;height:48px;line-height:48px}.offline-sync .info[data-v-762936ed]{font-size:12px;color:#909399}.offline-sync[data-v-762936ed] .el-tag.el-tag--info{border-color:transparent!important}.offline-sync .offline-top[data-v-762936ed]{margin:15px 0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.offline-sync .offline-top span[data-v-762936ed]{margin-left:10px;white-space:nowrap}.offline-sync .offline-top[data-v-762936ed] .el-input,.offline-sync .offline-top[data-v-762936ed] .el-input .el-input__inner{width:150px}.offline-sync .offline-table .dot[data-v-762936ed]{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:5px}.offline-sync .offline-table .dot.error[data-v-762936ed]{background:#f5222d}.offline-sync .offline-table .dot.success[data-v-762936ed]{background:#52c41a}.offline-sync .offline-table .dot.doing[data-v-762936ed]{background:#1740dc}.offline-sync .offline-table .dot.undone[data-v-762936ed]{background:#909399}.offline-sync .offline-table .dot.stop[data-v-762936ed]{background:#faae14}.offline-sync .offline-table .operator[data-v-762936ed]{white-space:nowrap;font-size:12px;color:#1740dc;cursor:pointer}.offline-sync .offline-table .operator .sync[data-v-762936ed]{color:#1740dc;cursor:pointer;margin-right:10px}.offline-sync .offline-table .operator .sync[disabled=disabled][data-v-762936ed]{color:#c0c4cf;cursor:not-allowed}.offline-sync .offline-table .operator[data-v-762936ed] .el-button,.offline-sync .offline-table .operator[data-v-762936ed] .el-button--text{padding:0!important}.offline-sync .offline-table .operator[data-v-762936ed]:nth-child(2),.offline-sync .offline-table .operator[data-v-762936ed]:nth-child(3){margin:0 8px}",""])},cd1c:function(e,t,a){var r=a("e853");e.exports=function(e,t){return new(r(e))(t)}},cd5e:function(e,t,a){var r=a("6cea");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a("499e").default)("42dde5f8",r,!0,{sourceMap:!1,shadowMode:!1})},e6af:function(e,t,a){var r=a("c364");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a("499e").default)("39200a4e",r,!0,{sourceMap:!1,shadowMode:!1})},e853:function(e,t,a){var r=a("d3f4"),i=a("1169"),n=a("2b4c")("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[n])&&(t=void 0)),void 0===t?Array:t}},ef76:function(e,t,a){"use strict";a("31a2")}}]);