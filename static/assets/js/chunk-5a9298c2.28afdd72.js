(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5a9298c2"],{"0bf3":function(e,t,n){(e.exports=n("2350")(!1)).push([e.i,'.primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.manual-logTable .form-inline .el-input,.manual-logTable .select-line .el-input{width:130px!important}.manual-logTable .cost-second .el-input{width:60px!important}.manual-logTable .el-form-item__content{line-height:32px}.log-status[data-v-log]:before{content:"";height:6px;width:6px;border-radius:50%;display:inline-block;background:#f5222d;margin-right:4px;vertical-align:middle}.success[data-v-log]:before{background:#52c41a}.process[data-v-log]:before{background:#1740dc}.fail[data-v-log]:before{background:#f5222d}.stop[data-v-log]:before{background:#faad14}',""])},"0e5e":function(e,t,n){"use strict";n("ca65")},5261:function(e,t,n){"use strict";n("9407")},"7a55":function(e,t,n){"use strict";n.r(t);n("7f7f"),n("8e6e"),n("ac6a"),n("456d"),n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("6b54"),n("c5f6");var o=n("ade3"),a=n("50f0"),r=n("c466");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw r}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var u={components:{filterTBHeader:a.a},data:function(){return{isLoading:!1,tabeleHeight:window.innerHeight-200,ascendingOrder:"",formInline:{user:"",state:"",name:"",costSecond:null,costSecondCom:"<=",consuming:"",job_log_type:"",proc_id:"",userId:"",reRunType:"",isOutHours:0,startTime:"",endTime:""},options_job_log_type:[{value:0,text:"作业流"},{value:1,text:"作业流依赖"}],reRunTypeList:[{value:1,text:"重跑"},{value:0,text:"正常运行"}],options_state:[{value:0,text:"失败"},{value:1,text:"成功"},{value:2,text:"运行中"},{value:5,text:"停止"}],overtimer:null,tableData:[],pageSize:10,pageIndex:1,addOrUpdateVisible:!1,factoryLists:[],dateValue:"",userList:[]}},created:function(){var e,t;this.dateValue=this.timeDefault,this.formInline.startTime=(null===(e=this.dateValue)||void 0===e?void 0:e.length)>0?this.dateValue[0]:"",this.formInline.endTime=(null===(t=this.dateValue)||void 0===t?void 0:t.length)>0?this.dateValue[1]:""},computed:{timeDefault:function(){var e=new Date,t=e.getTime()-864e6,n=e.getTime(),o=new Date(t),a=new Date(n);return[Object(r.a)(o,"yyyy-MM-dd hh:mm:ss"),Object(r.a)(a,"yyyy-MM-dd hh:mm:ss")]}},methods:{sortChange:function(e){var t=e.prop,n=e.order;e.column;if(this.$refs.table&&this.$refs.table.clearSort(),this.ascendingOrder=n,this.ascendingOrder||(this.formInline.consuming=null),"costSecond"==t){switch(n){case"ascending":this.formInline.consuming="ASC";break;case"descending":this.formInline.consuming="DESC";break;default:this.formInline.consuming=null}this.jobRunHistory()}},handleTheadStyle:function(e){e.row;var t=e.column;e.rowIndex,e.columnIndex;t.order=this.ascendingOrder},sizeChangeHandle:function(e){this.pageSize=e,this.pageIndex=1,this.jobRunHistory()},currentChangeHandle:function(e){this.pageIndex=e,this.jobRunHistory()},filter:function(e){this.pageIndex=1,1==e&&""==this.formInline.state&&(this.formInline.isOutHours=0),this.jobRunHistory()},reset:function(){this.dateValue="",this.formInline=this.$options.data().formInline,this.formInline.consuming="",this.ascendingOrder="",this.filter()},handleClick:function(e){},getJobLogType:function(e,t){for(var n in this.options_job_log_type)if(this.options_job_log_type[n].value===parseInt(e.jobLogType))return this.options_job_log_type[n].text},getRunType:function(e,t){var n,o=s(this.reRunTypeList);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(a.value==parseInt(e.reRunType))return a.text}}catch(e){o.e(e)}finally{o.f()}},dateChange:function(e){this.formInline.startTime=(null==e?void 0:e.length)>0?e[0]:"",this.formInline.endTime=(null==e?void 0:e.length)>0?e[1]:""},jobRunHistory:function(e){var t=this;this.isLoading=!e,this.$API.post(this.$URL.getJobRunHistoryList,l(l({page:this.pageIndex,limit:this.pageSize},this.formInline),{},{runType:0}),(function(e){if(t.isLoading=!1,0==e.code){t.tableData=e.page;var n,o=s(t.tableData.list);try{for(o.s();!(n=o.n()).done;){var a=n.value;0==a.jobLogType?a.name=a.jobName:a.name=a.depName}}catch(e){o.e(e)}finally{o.f()}}else t.$message.error(e.msg)}))},deleteLog:function(e,t){var n=this;this.isLoading=!0;var o={runId:e,jobLogType:t};this.$API.get(this.$URL.getJobRunHistoryDeleteHistory,o,(function(e){n.isLoading=!1,0===e.code?(n.jobRunHistory(),n.$message({message:"删除成功！",type:"success"})):n.$message.error(e.msg)}))},logTableHandle:function(e){window.open(window.location.origin+"/#/logInfo?"+(this.$route.query.id?"id=".concat(this.$route.query.id,"&"):"")+"logId=".concat(e.row.id,"&jobLogType=").concat(e.row.jobLogType,"&menuId=").concat(e.row.workMenuId,"\n      &oozieJobId=").concat(e.row.oozieJobId,"&fromList=ManualLog"))},getProcInfoListLog:function(){var e=this;this.$API.get(this.$URL.getProcInfoListLog,{type:0},(function(t){var n,o;0==t.code?(e.factoryLists=t.data,e.formInline.startTime=(null===(n=e.dateValue)||void 0===n?void 0:n.length)>0?e.dateValue[0]:"",e.formInline.endTime=(null===(o=e.dateValue)||void 0===o?void 0:o.length)>0?e.dateValue[1]:"",e.$route.query.projectId&&e.factoryLists.some((function(t){return t.id==e.$route.query.projectId}))&&(e.formInline.proc_id=Number(e.$route.query.projectId))):e.$message.error(t.msg)}))},getAllUsers:function(){var e=this;this.$API.get(this.$URL.getAllUsersLog,{type:0},(function(t){0==t.code?(e.userList=t.data,e.userList.filter((function(t){return t.userId==e.$store.state.old.admin_info.userId})).length>0&&(e.formInline.userId=e.$store.state.old.admin_info.userId),e.jobRunHistory()):e.$message.error(t.msg)}))}},mounted:function(){var e=this.$route.query;e.projectId&&(this.formInline.name=e.jobName,this.formInline.job_log_type=Number(e.jobType),this.formInline.startTime="",this.formInline.endTime="",this.dateValue=""),this.getAllUsers(),this.getProcInfoListLog()},beforeDestroy:function(){},watch:{}},d=(n("5261"),n("0e5e"),n("2877")),f=Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"manual-logTable"},[t("el-form",{staticClass:"demo-form-inline",staticStyle:{"text-align":"right"},attrs:{inline:!0,model:e.formInline,size:"small"}},[t("el-form-item",[t("el-select",{staticClass:"form-inline",staticStyle:{width:"190px"},attrs:{placeholder:"请选择项目",clearable:"",filterable:""},model:{value:e.formInline.proc_id,callback:function(t){e.$set(e.formInline,"proc_id",t)},expression:"formInline.proc_id"}},e._l(e.factoryLists,(function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",[t("el-select",{staticClass:"select-line",attrs:{placeholder:"请选择创建人",clearable:"",filterable:""},model:{value:e.formInline.userId,callback:function(t){e.$set(e.formInline,"userId",t)},expression:"formInline.userId"}},e._l(e.userList,(function(e){return t("el-option",{key:e.userId,attrs:{value:e.userId,label:e.username}})})),1)],1),t("el-form-item",[t("el-input",{staticClass:"input-with-select",staticStyle:{width:"200px"},attrs:{type:"Number",placeholder:"请输入耗时时间"},model:{value:e.formInline.costSecond,callback:function(t){e.$set(e.formInline,"costSecond",t)},expression:"formInline.costSecond"}},[t("el-select",{staticClass:"cost-second",attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.formInline.costSecondCom,callback:function(t){e.$set(e.formInline,"costSecondCom",t)},expression:"formInline.costSecondCom"}},[t("el-option",{attrs:{label:"<=",value:"<="}}),t("el-option",{attrs:{label:">=",value:">="}})],1)],1)],1),t("el-form-item",[t("el-input",{staticStyle:{width:"170px !important"},attrs:{placeholder:"请输入作业流[依赖]名称"},model:{value:e.formInline.name,callback:function(t){e.$set(e.formInline,"name",t)},expression:"formInline.name"}})],1),t("el-form-item",[t("el-date-picker",{staticClass:"date",staticStyle:{width:"360px!important"},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.dateChange},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.filter}},[e._v("查询")])],1),t("el-form-item",{staticStyle:{"margin-right":"0"}},[t("el-button",{attrs:{size:"mini"},on:{click:e.reset}},[e._v("重置")])],1)],1),t("div",{staticClass:"table_wrap"},[t("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData.list,"header-cell-style":e.handleTheadStyle},on:{"sort-change":e.sortChange}},[t("el-table-column",{attrs:{prop:"projectName","min-width":"200","show-overflow-tooltip":"",label:"项目"}}),t("el-table-column",{attrs:{prop:"name","min-width":"200","show-overflow-tooltip":"",label:"作业流[依赖]名称"}}),t("el-table-column",{attrs:{formatter:e.getRunType,"min-width":"120"},scopedSlots:e._u([{key:"header",fn:function(n){return[t("filter-t-b-header",{attrs:{label:"日志类型",filter:e.reRunTypeList,hasAll:"",value:e.formInline.reRunType},on:{"update:value":function(t){return e.$set(e.formInline,"reRunType",t)},comfirm:e.filter}})]}}])}),t("el-table-column",{attrs:{prop:"jobLogType",formatter:e.getJobLogType},scopedSlots:e._u([{key:"header",fn:function(n){return[t("filter-t-b-header",{attrs:{label:"类型",filter:e.options_job_log_type,hasAll:!0,value:e.formInline.job_log_type},on:{"update:value":function(t){return e.$set(e.formInline,"job_log_type",t)},comfirm:e.filter}})]}}])}),t("el-table-column",{attrs:{prop:"createPerName",label:"创建人"}}),t("el-table-column",{attrs:{"min-width":"120"},scopedSlots:e._u([{key:"header",fn:function(n){return[t("filter-t-b-header",{attrs:{label:"运行状态",filter:e.options_state,value:e.formInline.state},on:{"update:value":function(t){return e.$set(e.formInline,"state",t)},comfirm:e.filter}},[t("template",{slot:"foot"},[t("div",{staticStyle:{padding:"0 10px 10px 0","text-align":"right"}},[t("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.formInline.isOutHours,callback:function(t){e.$set(e.formInline,"isOutHours",t)},expression:"formInline.isOutHours"}},[e._v("超时")])],1)])],2)]}},{key:"default",fn:function(n){var o=n.row;return[t("span",{staticClass:"log-status",class:{success:"成功"===o.stateName,fail:"失败"===o.stateName,process:"运行中"===o.stateName,stop:"停止"===o.stateName},attrs:{"data-v-log":""}},[e._v(e._s(o.stateName))]),1==o.isOutHours?t("span",{staticClass:"out_hours"},[e._v("超时")]):e._e()]}}])}),t("el-table-column",{attrs:{"min-width":"120",sortable:"",prop:"costSecond",label:"运行耗时(s)"}}),t("el-table-column",{attrs:{prop:"beginTime","min-width":"150",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"endTime","min-width":"180",label:"结束时间"}}),t("el-table-column",{attrs:{fixed:"right",width:"120","header-align":"right",align:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.logTableHandle(n)}}},[e._v("查看日志")]),e.$checkPermission("manualLog_delete")?t("el-button",{staticClass:"error-color",attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteLog(n.row.id,n.row.jobLogType)}}},[e._v("删除")]):e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.tableData.currPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,total:e.tableData.totalCount,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.sizeChangeHandle,"current-change":e.currentChangeHandle}})],1)],1)}),[],!1,null,"458a201e",null);t.default=f.exports},"8cc0":function(e,t,n){(e.exports=n("2350")(!1)).push([e.i,".primary-color[data-v-458a201e]{color:#1740dc}.success-color[data-v-458a201e]{color:#52c41a}.warning-color[data-v-458a201e]{color:#faad14}.error-color[data-v-458a201e]{color:#f5222d}.info-color[data-v-458a201e]{color:#909399}.border-color[data-v-458a201e]{border:1px solid #e5e6e9}.manual-logTable[data-v-458a201e] .input-with-select .el-input-group__prepend{background-color:#fff}.manual-logTable .input-with-select[data-v-458a201e] .el-input__inner{padding-right:2px}.manual-logTable[data-v-458a201e] .el-input-group{vertical-align:baseline}.manual-logTable[data-v-458a201e] .el-form--inline .el-form-item__content{vertical-align:middle}.mod-user[data-v-458a201e]{margin-top:20px;text-align:left}.manual-logTable[data-v-458a201e]{padding:20px;height:100%}.manual-logTable .date[data-v-458a201e]{padding-top:1px}.form-inline[data-v-458a201e]{max-width:130px}.out_hours[data-v-458a201e]{background:rgba(250,174,20,.1);color:#faae14;font-size:10px;padding:2px;margin-left:6px;border:1px solid #faae14}",""])},9407:function(e,t,n){var o=n("8cc0");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,n("499e").default)("fdeb7fa2",o,!0,{sourceMap:!1,shadowMode:!1})},c466:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("3b2b"),n("a481");function o(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var o in n)if(new RegExp("(".concat(o,")")).test(t)){var r=n[o]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?r:a(r))}return t}function a(e){return("00"+e).substr(e.length)}},ca65:function(e,t,n){var o=n("0bf3");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,n("499e").default)("55752ee5",o,!0,{sourceMap:!1,shadowMode:!1})}}]);