(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6809c327"],{"00fc":function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,'.primary-color[data-v-e9fbbcb2]{color:#1740dc}.success-color[data-v-e9fbbcb2]{color:#52c41a}.warning-color[data-v-e9fbbcb2]{color:#faad14}.error-color[data-v-e9fbbcb2]{color:#f5222d}.info-color[data-v-e9fbbcb2]{color:#909399}.border-color[data-v-e9fbbcb2]{border:1px solid #e5e6e9}[data-v-e9fbbcb2] .form-title{font-size:14px;font-weight:500;margin-bottom:20px}[data-v-e9fbbcb2] .form-title:before{content:"";height:14px;width:3px;background-color:#00f;display:inline-block;vertical-align:-3px;margin-right:10px;padding-top:2px}.create-standard[data-v-e9fbbcb2]{position:relative;background-color:#f0f2f5;height:100%}.top[data-v-e9fbbcb2]{background-color:#fff;height:48px;line-height:48px;border:1px solid #e5e6e9;position:relative}.top .title[data-v-e9fbbcb2]{padding:0 20px;font-weight:500;color:#040c2c;font-size:16px}.content[data-v-e9fbbcb2]{background-color:#fff;height:calc(100% - 96px);overflow-y:auto;padding:15px 20px}.content .create-form .el-row[data-v-e9fbbcb2]{margin-bottom:18px;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.content .rule-table[data-v-e9fbbcb2] .el-table__body .cell{padding-left:0}.content .rule-table[data-v-e9fbbcb2] .el-table__body .el-form-item:last-child{margin-bottom:0!important}.content .tableFieldList[data-v-e9fbbcb2] .el-form-item__content{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex}.content[data-v-e9fbbcb2] .rule-table:before{background-color:inherit}.content .create-standard[data-v-e9fbbcb2] .el-form-item--mini .el-form-item__error{white-space:nowrap}.content .delete-op[data-v-e9fbbcb2]{color:#040c2c}.content .delete-op[data-v-e9fbbcb2]:hover{color:#1740dc}.content .addNew[data-v-e9fbbcb2]{width:100%;height:32px;line-height:32px;color:#040c2c;text-align:center;border:1px dashed #d9d9d9;cursor:pointer;margin-bottom:20px}.content .addNew[data-v-e9fbbcb2]:hover{color:#1740dc}.isCollapse.bottom[data-v-e9fbbcb2]{width:calc(100% - 64px)}.bottom[data-v-e9fbbcb2]{position:fixed;bottom:0;right:0;width:100%;background-color:#fff;text-align:right;height:48px;padding-right:20px;line-height:48px;width:calc(100% - 207px)}',""])},7640:function(e,t,r){"use strict";r("9f17")},"9f17":function(e,t,r){var a=r("00fc");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,r("499e").default)("50e765c2",a,!0,{sourceMap:!1,shadowMode:!1})},bf7f:function(e,t,r){"use strict";r.r(t);r("7f7f"),r("8e6e"),r("ac6a"),r("456d"),r("c5f6");var a=r("ade3"),o=r("80e1"),l=r("d8ad");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var n=function(e,t,r){return t>12e5?r(new Error("超时时间不能超过1200000ms")):t<3e3?r(new Error("最小时间不能小于3000ms")):r()},c={name:"devementDataTaskServer",computed:{isCollapse:function(){return this.$store.state.old.isCollapse}},props:{},components:{CreateOrEditServiceGroup:o.a},data:function(){return{validatorOfTimeOut:n,serviceGroupLoading:!1,handleSureLoading:!1,tenantList:[],relationDataList:[],serviceGroupList:[],taskId:"",dataServiceId:"",ruleForm:{workType:1,operationType:0,workNameCreact:"",procName:"",procCreact:"",groupIdobj:"",serviceTimeOut:3e3,serviceDetailType:1,serviceName:"",requestType:0,requestWay:"http",serviceType:3,serviceDescription:"",servicePath:"",isExtendToken:2,workNode:0,tenantId:"",groupId:"",relationDataServiceId:"",relationTaskId:""},rules:{serviceTimeOut:[{required:!0,message:"请输入超时时间",trigger:"blur"},{pattern:/^[1-9]{1}[0-9]*$/,message:"请输入正整数"},{validator:n,trigger:"change"}],isExtendToken:[{required:!0,message:"请选择继承服务组token",trigger:"change"}],requestType:[{required:!0,message:"请选择请求方式",trigger:"change"}],requestWay:[{required:!0,message:"请选择请求类型",trigger:"change"}],serviceDetailType:[{required:!0,message:"请选择服务类型",trigger:"change"}],serviceName:[{required:!0,message:"请输入服务名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"},{pattern:/^[\u4E00-\u9FA5a-zA-Z0-9_]*$/,message:"只能输入中英文，数字，下划线"}],directorName:[{required:!0,message:"请输入标准负责人",trigger:"blur"},{pattern:/^[\u4E00-\u9FA5a-zA-Z，,\s]*$/,message:"只能输入中英文，空格，逗号"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],groupIdobj:[{required:!0,message:"请选择所属服务组",trigger:"change"}],servicePath:[{required:!0,message:"请选择服务路径",trigger:"change"}],relationDataServiceId:[{required:!0,message:"请选择所属公共服务",trigger:"change"}],serviceDescription:[{required:!0,message:"请输入标准描述",trigger:"change"}]}}},methods:{changeGroup:function(e){this.ruleForm.groupId=e.id,this.getGroupServiceUrl(e.id)},cancelHandle:function(){l.a.$emit("close_current_tags")},createServeGroud:function(){this.$refs.creaDialog.openDialog(0)},copyText:function(e){if(e){var t=e,r=document.createElement("input");r.value=t,document.body.appendChild(r),r.select(),document.execCommand("Copy"),this.$message({message:"复制成功",type:"success"}),r.remove()}else this.$message({message:"没有值不可复制,请复制正确的任务ID",type:"error"})},JobNodeDetailsinfo:function(e,t){var r=this;this.$API.get(this.$URL.JobNodeDetailsinfo+"/".concat(e,"/").concat(t),{},(function(e){0==e.code&&e.data?r.ruleForm=Object.assign(r.ruleForm,e.data):r.$message.error(e.msg)}))},getGroupServiceUrl:function(e){var t=this;this.$API.get(this.$URL.getGroupServiceUrl+e,{},(function(e){0==e.code&&e.data?t.ruleForm.servicePath="/"+e.data:t.$message.error(e.msg)}))},getTenantListOtherList:function(){var e=this;this.$API.get(this.$URL.getStateAllList,{},(function(t){0==t.code?t.data&&t.data.length>0&&(e.tenantList=t.data):e.$message.error(t.msg)}))},getDataServiceDetailById:function(e){var t=this;this.$API.get(this.$URL.getDataServiceDetailById+"/".concat(e),{},(function(e){0==e.code&&e.data?(t.ruleForm=Object.assign(t.ruleForm,e.data),t.ruleForm.relationTaskId=t.ruleForm.params[0].defaultValue,t.JobNodeDetailsinfo(t.ruleForm.workType,t.ruleForm.params[0].defaultValue),t.ruleForm.requestWay="http",t.ruleForm.servicePath=t.ruleForm.serviceUrl):t.$message.error(e.msg)}))},getDataServiceGroupList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r={current:1,size:20,serviceGroupName:t};this.serviceGroupLoading=!0,this.$API.post(this.$URL.getDataServiceGroupList,s({},r),(function(t){0==t.code?e.serviceGroupList=t.page.records:e.$message.error(t.msg),e.serviceGroupLoading=!1}))},getCommonlistPageList:function(){var e=this;this.$API.post(this.$URL.getCommonlistPageList,{},(function(t){0==t.code&&(e.relationDataList=t.page)}))},editDataService:function(){var e=this;this.handleSureLoading=!0,this.$API.post(this.$URL.editDataService,s({},this.ruleForm),(function(t){0==t.code?e.$message.success("一键发布服务成功"):e.$message.error(t.msg),e.handleSureLoading=!1,e.$router.push("/myServe/serviceManagement")}))},handleSure:function(){var e=this,t=[{paramName:"id",bindingField:"ID",paramPosition:"1",isRequired:1,paramType:"bigint",defaultValue:this.taskId,paramDesc:""}],r=s(s({},this.ruleForm),{},{taskType:this.ruleForm.operationType,params:t});this.dataServiceId&&delete(r=s(s({},this.ruleForm),{},{id:this.dataServiceId,updateTime:null})).updateTime;var a=this.dataServiceId?this.$URL.editDataService:this.$URL.addDataService;this.$refs.ruleForm.validate((function(t){t&&(delete e.ruleForm.groupIdobj,e.handleSureLoading=!0,e.$API.post(a,s({},r),(function(t){0==t.code?(e.$message.success("一键发布服务成功"),e.$router.push("/myServe/serviceManagement")):e.$message.error(t.msg),e.handleSureLoading=!1})))}))}},mounted:function(){this.getCommonlistPageList();var e=this.$route.query,t=e.workType,r=e.taskId,a=e.isStop,o=e.isUp,l=e.dataServiceId;t&&r&&(this.ruleForm.workType=Number(t),this.taskId=r,this.ruleForm.relationTaskId=r,this.ruleForm.operationType=Number(a),this.ruleForm.workNode=Number(o),this.JobNodeDetailsinfo(t,r)),this.dataServiceId=l,l&&this.getDataServiceDetailById(l),this.getTenantListOtherList(),this.getDataServiceGroupList()},watch:{}},u=(r("7640"),r("2877")),d=Object(u.a)(c,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"create-standard"},[e._m(0),t("div",{staticClass:"content zt-scrollbar"},[t("el-alert",{staticClass:"zt-alert",staticStyle:{"margin-bottom":"20px"},attrs:{title:"一键发布服务成功后，可在数据服务平台—服务组列表中所属服务组内进行此API的查看及管理。",type:"info","show-icon":"","close-text":"知道了"}}),t("el-form",{ref:"ruleForm",staticClass:"ruleForm create-form",attrs:{model:e.ruleForm,rules:e.rules,"label-position":"left","label-width":"130px",size:"mini"}},[t("div",{staticClass:"form-title"},[e._v("开发任务")]),t("div",{staticStyle:{padding:"10px 60px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{label:"任务类型"}},[t("el-radio-group",{attrs:{disabled:""},model:{value:e.ruleForm.workType,callback:function(t){e.$set(e.ruleForm,"workType",t)},expression:"ruleForm.workType"}},[t("el-radio",{attrs:{label:1}},[e._v("作业流")]),t("el-radio",{attrs:{label:2}},[e._v("作业流依赖")]),t("el-radio",{attrs:{label:0}},[e._v("任务")])],1)],1),0==e.ruleForm.workType?t("el-form-item",{attrs:{label:"任务名称"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.taskName,callback:function(t){e.$set(e.ruleForm,"taskName",t)},expression:"ruleForm.taskName"}})],1):e._e(),0==e.ruleForm.workType&&1==e.ruleForm.workNode?t("el-form-item",{attrs:{label:"上游任务链"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.upTaskLink,callback:function(t){e.$set(e.ruleForm,"upTaskLink",t)},expression:"ruleForm.upTaskLink"}})],1):e._e(),0==e.ruleForm.workType&&2==e.ruleForm.workNode?t("el-form-item",{attrs:{label:"下游任务链"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.dowTaskLink,callback:function(t){e.$set(e.ruleForm,"dowTaskLink",t)},expression:"ruleForm.dowTaskLink"}})],1):e._e(),t("el-form-item",{attrs:{label:"作业流".concat(2==e.ruleForm.workType?"依赖":"","名称")}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.workName,callback:function(t){e.$set(e.ruleForm,"workName",t)},expression:"ruleForm.workName"}})],1),t("el-form-item",{attrs:{label:"所属项目"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.procName,callback:function(t){e.$set(e.ruleForm,"procName",t)},expression:"ruleForm.procName"}})],1)],1),t("el-col",{staticStyle:{"margin-left":"20px"},attrs:{span:11}},[t("el-form-item",{attrs:{label:"操作类型"}},[t("el-radio-group",{attrs:{disabled:""},model:{value:e.ruleForm.operationType,callback:function(t){e.$set(e.ruleForm,"operationType",t)},expression:"ruleForm.operationType"}},[t("el-radio",{attrs:{label:0}},[e._v("运行")]),t("el-radio",{attrs:{label:1}},[e._v("停止")])],1)],1),0==e.ruleForm.workType?t("el-form-item",{attrs:{label:"任务创建人"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.taskCreate,callback:function(t){e.$set(e.ruleForm,"taskCreate",t)},expression:"ruleForm.taskCreate"}})],1):e._e(),0==e.ruleForm.workType&&1==e.ruleForm.workNode?t("el-form-item",{attrs:{label:"上游任务创建人"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.upTaskCreate,callback:function(t){e.$set(e.ruleForm,"upTaskCreate",t)},expression:"ruleForm.upTaskCreate"}})],1):e._e(),0==e.ruleForm.workType&&2==e.ruleForm.workNode?t("el-form-item",{attrs:{label:"下游任务创建人"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.dowTaskCreate,callback:function(t){e.$set(e.ruleForm,"dowTaskCreate",t)},expression:"ruleForm.dowTaskCreate"}})],1):e._e(),t("el-form-item",{attrs:{label:"作业流".concat(2==e.ruleForm.workType?"依赖":"","创建人")}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.workNameCreact,callback:function(t){e.$set(e.ruleForm,"workNameCreact",t)},expression:"ruleForm.workNameCreact"}})],1),t("el-form-item",{attrs:{label:"项目创建人"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.procCreact,callback:function(t){e.$set(e.ruleForm,"procCreact",t)},expression:"ruleForm.procCreact"}})],1)],1)],1)],1),t("div",{staticClass:"form-title"},[e._v("配置API信息")]),t("div",{staticStyle:{padding:"10px 60px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{label:"服务类型",prop:"serviceDetailType"}},[t("el-tooltip",{staticStyle:{position:"relative",left:"-10px"},attrs:{placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                  公共：公共服务不需要授权，默认对外开放，创建完成后可直接在服务集市查询并调用。"),t("br"),e._v("定制：定制服务需要服务创建者发布后才能在集市中查询到,用户申请授权,通过后才能使用\n                ")]),t("i",{staticClass:"el-icon-question"})]),t("el-radio-group",{attrs:{disabled:""},model:{value:e.ruleForm.serviceDetailType,callback:function(t){e.$set(e.ruleForm,"serviceDetailType",t)},expression:"ruleForm.serviceDetailType"}},[t("el-radio",{attrs:{label:1}},[e._v("定制")]),t("el-radio",{attrs:{label:2}},[e._v("公共")])],1)],1),e.dataServiceId?e._e():t("el-form-item",{attrs:{prop:"groupIdobj",label:"所属服务组"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[t("el-select",{staticStyle:{width:"87%"},attrs:{multiple:!1,"value-key":"id",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":function(t){e.getDataServiceGroupList(t)},loading:e.serviceGroupLoading},on:{focus:function(){e.getDataServiceGroupList()},change:e.changeGroup},model:{value:e.ruleForm.groupIdobj,callback:function(t){e.$set(e.ruleForm,"groupIdobj",t)},expression:"ruleForm.groupIdobj"}},e._l(e.serviceGroupList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.serviceGroupName,value:e}})})),1),t("a",{on:{click:e.createServeGroud}},[e._v("新建")])],1)]),t("el-form-item",{attrs:{prop:"servicePath",label:"服务组路径"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.servicePath,callback:function(t){e.$set(e.ruleForm,"servicePath",t)},expression:"ruleForm.servicePath"}})],1),t("el-form-item",{attrs:{label:"返回类型"}},[e._v("\n              JSON\n            ")]),t("el-form-item",{attrs:{label:"继承服务组token",prop:"isExtendToken"}},[t("el-radio-group",{model:{value:e.ruleForm.isExtendToken,callback:function(t){e.$set(e.ruleForm,"isExtendToken",t)},expression:"ruleForm.isExtendToken"}},[t("el-radio",{attrs:{label:1}},[e._v("是")]),t("el-radio",{attrs:{label:2}},[e._v("否")])],1)],1),t("el-form-item",{attrs:{prop:"",label:"授权租户"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:2==e.ruleForm.serviceDetailType,multiple:"",clearable:""},model:{value:e.ruleForm.tenantId,callback:function(t){e.$set(e.ruleForm,"tenantId",t)},expression:"ruleForm.tenantId"}},e._l(e.tenantList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-col",{staticStyle:{"margin-left":"20px"},attrs:{span:11}},[t("el-form-item",{attrs:{prop:"serviceName",label:"服务名称"}},[t("el-input",{attrs:{placeholder:"请输入中英文、数字、或下划线"},model:{value:e.ruleForm.serviceName,callback:function(t){e.$set(e.ruleForm,"serviceName",t)},expression:"ruleForm.serviceName"}})],1),t("el-form-item",{attrs:{prop:"requestWay",label:"请求类型"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.ruleForm.requestWay,callback:function(t){e.$set(e.ruleForm,"requestWay",t)},expression:"ruleForm.requestWay"}},e._l(["http"],(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"请求方式",prop:"requestType"}},[t("el-radio-group",{staticStyle:{"margin-right":"15px"},model:{value:e.ruleForm.requestType,callback:function(t){e.$set(e.ruleForm,"requestType",t)},expression:"ruleForm.requestType"}},[t("el-radio",{attrs:{label:0}},[e._v("GET")]),t("el-radio",{attrs:{label:1}},[e._v("POST")])],1)],1),t("el-form-item",{attrs:{prop:"serviceTimeOut",label:"超时时间"}},[t("el-input",{attrs:{placeholder:"默认3000"},model:{value:e.ruleForm.serviceTimeOut,callback:function(t){e.$set(e.ruleForm,"serviceTimeOut",t)},expression:"ruleForm.serviceTimeOut"}},[t("template",{slot:"append"},[e._v("ms")])],2)],1),t("el-form-item",{attrs:{prop:"serviceDescription",label:"服务描述"}},[t("el-input",{attrs:{type:"textarea",rows:4,"show-word-limit":"",maxlength:200,placeholder:"请输入服务描述,200字符以内"},model:{value:e.ruleForm.serviceDescription,callback:function(t){e.$set(e.ruleForm,"serviceDescription",t)},expression:"ruleForm.serviceDescription"}})],1)],1)],1)],1),t("div",{staticClass:"form-title"},[e._v("配置任务执行结果查询")]),t("div",{staticStyle:{padding:"10px 60px"}},[t("div",{staticStyle:{"margin-bottom":"15px"}},[t("i",{staticClass:"el-icon-warning",staticStyle:{color:"#1740DC"}}),e._v("发布成服务后，此任务的运行结果请通过任务ID在服务集市中的公共服务查询")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{label:"任务ID"}},[t("el-input",{staticStyle:{width:"87%"},attrs:{disabled:""},model:{value:e.ruleForm.relationTaskId,callback:function(t){e.$set(e.ruleForm,"relationTaskId",t)},expression:"ruleForm.relationTaskId"}}),t("span",{staticStyle:{"margin-left":"15px",color:"#1740DC",cursor:"pointer"},on:{click:function(t){return e.copyText(e.ruleForm.relationTaskId)}}},[e._v("复制")])],1),t("el-form-item",{attrs:{prop:"relationDataServiceId",label:"所属公共服务"}},[t("el-select",{staticStyle:{width:"87%"},attrs:{clearable:""},model:{value:e.ruleForm.relationDataServiceId,callback:function(t){e.$set(e.ruleForm,"relationDataServiceId",t)},expression:"ruleForm.relationDataServiceId"}},e._l(e.relationDataList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.serviceName,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:12}})],1)],1)])],1),t("div",{staticClass:"bottom"},[t("el-button",{on:{click:e.cancelHandle}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.handleSureLoading},on:{click:e.handleSure}},[e._v("一键发布服务")])],1),t("CreateOrEditServiceGroup",{ref:"creaDialog"})],1)}),[function(){var e=this._self._c;return e("div",{staticClass:"top"},[e("span",{staticClass:"title"},[this._v("开发任务发布成服务")])])}],!1,null,"e9fbbcb2",null);t.default=d.exports},d8ad:function(e,t,r){"use strict";var a=new(r("2b0e").default);t.a=a}}]);