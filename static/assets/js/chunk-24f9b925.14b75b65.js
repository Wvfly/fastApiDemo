(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-24f9b925"],{"0f71":function(e,t,o){(e.exports=o("2350")(!1)).push([e.i,'.primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.task-logTable .form-inline .el-input,.task-logTable .select-line .el-input{width:130px!important}.task-logTable .cost-second .el-input{width:60px!important}.task-logTable .el-form-item__content{line-height:32px}.log-status[data-v-log]:before{content:"";height:6px;width:6px;border-radius:50%;display:inline-block;background:#f5222d;margin-right:4px;vertical-align:middle}.success[data-v-log]:before{background:#52c41a}.process[data-v-log]:before{background:#1740dc}.fail[data-v-log]:before{background:#f5222d}.stop[data-v-log]:before{background:#faad14}',""])},8791:function(e,t,o){var n=o("d5cc");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,o("499e").default)("5dd3116b",n,!0,{sourceMap:!1,shadowMode:!1})},ae09:function(e,t,o){"use strict";o("cb5f")},c466:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));o("3b2b"),o("a481");function n(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var n in o)if(new RegExp("(".concat(n,")")).test(t)){var a=o[n]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?a:r(a))}return t}function r(e){return("00"+e).substr(e.length)}},cb5f:function(e,t,o){var n=o("0f71");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,o("499e").default)("bad8f3be",n,!0,{sourceMap:!1,shadowMode:!1})},d5cc:function(e,t,o){(e.exports=o("2350")(!1)).push([e.i,".primary-color[data-v-e189f1cc]{color:#1740dc}.success-color[data-v-e189f1cc]{color:#52c41a}.warning-color[data-v-e189f1cc]{color:#faad14}.error-color[data-v-e189f1cc]{color:#f5222d}.info-color[data-v-e189f1cc]{color:#909399}.border-color[data-v-e189f1cc]{border:1px solid #e5e6e9}.task-logTable[data-v-e189f1cc] .input-with-select .el-input-group__prepend{background-color:#fff}.task-logTable .input-with-select[data-v-e189f1cc] .el-input__inner{padding-right:2px}.task-logTable[data-v-e189f1cc] .el-input-group{vertical-align:baseline}.task-logTable[data-v-e189f1cc] .el-form--inline .el-form-item__content{vertical-align:middle}.mod-user[data-v-e189f1cc]{margin-top:20px;text-align:left}.task-logTable[data-v-e189f1cc]{padding:20px;height:100%}.task-logTable .date[data-v-e189f1cc]{padding-top:1px}.task-logTable .activeSorts[data-v-e189f1cc]{color:red}.form-inline[data-v-e189f1cc]{max-width:130px!important}.out_hours[data-v-e189f1cc]{background:rgba(250,174,20,.1);color:#faae14;font-size:10px;padding:2px;margin-left:6px;border:1px solid #faae14}",""])},dc1d:function(e,t,o){"use strict";o("8791")},e1fb:function(e,t,o){"use strict";o.r(t);o("7f7f"),o("ac4d"),o("8a81"),o("1c4c"),o("6b54"),o("8e6e"),o("456d"),o("ac6a"),o("5df3"),o("96cf");var n=o("1da1"),r=(o("c5f6"),o("ade3")),a=o("50f0"),i=o("c466");function l(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==o.return||o.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){Object(r.a)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var d,f={components:{filterTBHeader:a.a},data:function(){return{isLoading:!1,tabeleHeight:window.innerHeight-200,activeSort:"",ascendingOrder:"",formInline:{user:"",state:"",name:"",costSecond:null,costSecondCom:"<=",consuming:"",job_log_type:"",proc_id:"",userId:"",isOutHours:0,startTime:"",endTime:""},options_job_log_type:[{value:0,text:"作业流"},{value:1,text:"作业流依赖"}],options_state:[{value:0,text:"失败"},{value:1,text:"成功"},{value:2,text:"运行中"},{value:5,text:"停止"}],overtimer:null,tableData:[],pageSize:10,pageIndex:1,addOrUpdateVisible:!1,factoryLists:[],userList:[],dateValue:"",mapTypes:{0:"手动运行",1:"定时调度",2:"循环调度",3:"crontab调度"}}},created:function(){var e,t;this.dateValue=this.timeDefault,this.formInline.startTime=(null===(e=this.dateValue)||void 0===e?void 0:e.length)>0?this.dateValue[0]:"",this.formInline.endTime=(null===(t=this.dateValue)||void 0===t?void 0:t.length)>0?this.dateValue[1]:""},computed:{timeDefault:function(){var e=new Date,t=e.getTime()-864e6,o=e.getTime(),n=new Date(t),r=new Date(o);return[Object(i.a)(n,"yyyy-MM-dd hh:mm:ss"),Object(i.a)(r,"yyyy-MM-dd hh:mm:ss")]}},methods:{sortChange:function(e){var t=e.prop,o=e.order;e.column;if(this.$refs.table&&this.$refs.table.clearSort(),this.ascendingOrder=o,"costSecond"===t){switch(o){case"ascending":this.formInline.consuming="ASC";break;case"descending":this.formInline.consuming="DESC";break;default:this.formInline.consuming=null}this.jobRunHistory()}},handleTheadStyle:function(e){e.row;var t=e.column;e.rowIndex,e.columnIndex;t.order=this.ascendingOrder},sortHandle:function(e){this.activeSort=e,this.formInline.consuming="top"==e?"ASC":"DESC",this.jobRunHistory()},sizeChangeHandle:function(e){this.pageSize=e,this.pageIndex=1,this.jobRunHistory()},currentChangeHandle:function(e){this.pageIndex=e,this.jobRunHistory()},filter:function(e){this.pageIndex=1,1==e&&""==this.formInline.state&&(this.formInline.isOutHours=0),this.jobRunHistory()},reset:function(){this.dateValue="",this.formInline=this.$options.data().formInline,this.formInline.consuming="",this.ascendingOrder="",this.filter()},handleClick:function(e){},getJobLogType:function(e,t){for(var o in this.options_job_log_type)if(this.options_job_log_type[o].value==parseInt(e.jobLogType))return this.options_job_log_type[o].text},jobRunHistory:function(e){var t=this;this.isLoading=!e,this.$API.post(this.$URL.getJobRunHistoryList,u(u({page:this.pageIndex,limit:this.pageSize},this.formInline),{},{runType:1}),(function(e){if(t.isLoading=!1,0==e.code){t.tableData=e.page;var o,n=l(t.tableData.list);try{for(n.s();!(o=n.n()).done;){var r=o.value;0==r.jobLogType?r.name=r.jobName:r.name=r.depName}}catch(e){n.e(e)}finally{n.f()}}else t.$message.error(e.msg)}))},deleteLog:function(e,t){var o=this;this.isLoading=!0;var n={runId:e,jobLogType:t};this.$API.get(this.$URL.getJobRunHistoryDeleteHistory,n,(function(e){o.isLoading=!1,0===e.code?(o.jobRunHistory(),o.$message({message:"删除成功！",type:"success"})):o.$message.error(e.msg)}))},logTableHandle:function(e){window.open(window.location.origin+"/#/logInfo?"+(this.$route.query.id?"id=".concat(this.$route.query.id,"&"):"")+"logId=".concat(e.row.id,"&jobLogType=").concat(e.row.jobLogType,"&menuId=").concat(e.row.workMenuId,"\n      &oozieJobId=").concat(e.row.oozieJobId,"&fromList=autoLog"))},getProcInfoListLog:function(){var e=this;this.$API.get(this.$URL.getProcInfoListLog,{type:1},(function(t){var o,n;0==t.code?(e.factoryLists=t.data,e.formInline.startTime=(null===(o=e.dateValue)||void 0===o?void 0:o.length)>0?e.dateValue[0]:"",e.formInline.endTime=(null===(n=e.dateValue)||void 0===n?void 0:n.length)>0?e.dateValue[1]:"",e.$route.query.projectId&&e.factoryLists.some((function(t){return t.id==e.$route.query.projectId}))&&(e.formInline.proc_id=Number(e.$route.query.projectId))):e.$message.error(t.msg)}))},dateChange:function(e){this.formInline.startTime=(null==e?void 0:e.length)>0?e[0]:"",this.formInline.endTime=(null==e?void 0:e.length)>0?e[1]:""},getAllUsers:function(){var e=this;this.$API.get(this.$URL.getAllUsersLog,{type:1},(function(t){0==t.code?(e.userList=t.data,e.userList.filter((function(t){return t.userId==e.$store.state.old.admin_info.userId})).length>0&&(e.formInline.userId=e.$store.state.old.admin_info.userId),e.jobRunHistory()):e.$message.error(t.msg)}))}},mounted:(d=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.$route.query).projectId&&(this.formInline.name=t.jobName,this.formInline.job_log_type=Number(t.jobType),this.formInline.startTime="",this.formInline.endTime="",this.dateValue=""),e.next=4,Promise.all([this.getProcInfoListLog(),this.getAllUsers()]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),beforeDestroy:function(){},watch:{}},p=(o("dc1d"),o("ae09"),o("2877")),m=Object(p.a)(f,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"task-logTable"},[t("el-form",{staticClass:"demo-form-inline",staticStyle:{"text-align":"right"},attrs:{inline:!0,model:e.formInline,size:"small"}},[t("el-form-item",[t("el-select",{staticClass:"form-inline",attrs:{placeholder:"请选择项目",clearable:"",filterable:""},model:{value:e.formInline.proc_id,callback:function(t){e.$set(e.formInline,"proc_id",t)},expression:"formInline.proc_id"}},e._l(e.factoryLists,(function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",[t("el-select",{staticClass:"select-line",attrs:{placeholder:"请选择创建人",clearable:"",filterable:""},model:{value:e.formInline.userId,callback:function(t){e.$set(e.formInline,"userId",t)},expression:"formInline.userId"}},e._l(e.userList,(function(e){return t("el-option",{key:e.userId,attrs:{value:e.userId,label:e.username}})})),1)],1),t("el-form-item",[t("el-input",{staticClass:"input-with-select",staticStyle:{width:"180px"},attrs:{type:"Number",placeholder:"请输入耗时时间"},model:{value:e.formInline.costSecond,callback:function(t){e.$set(e.formInline,"costSecond",t)},expression:"formInline.costSecond"}},[t("el-select",{staticClass:"cost-second",attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.formInline.costSecondCom,callback:function(t){e.$set(e.formInline,"costSecondCom",t)},expression:"formInline.costSecondCom"}},[t("el-option",{attrs:{label:"<=",value:"<="}}),t("el-option",{attrs:{label:">=",value:">="}})],1)],1)],1),t("el-form-item",[t("el-input",{staticStyle:{width:"170px !important"},attrs:{placeholder:"请输入作业流[依赖]名称"},model:{value:e.formInline.name,callback:function(t){e.$set(e.formInline,"name",t)},expression:"formInline.name"}})],1),t("el-form-item",[t("el-date-picker",{staticClass:"date",staticStyle:{width:"360px !important"},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.dateChange},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.filter}},[e._v("查询")])],1),t("el-form-item",{staticStyle:{"margin-right":"0"}},[t("el-button",{attrs:{size:"mini"},on:{click:e.reset}},[e._v("重置")])],1)],1),t("div",{staticClass:"table_wrap"},[t("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData.list,"header-cell-style":e.handleTheadStyle},on:{"sort-change":e.sortChange}},[t("el-table-column",{attrs:{"min-width":"200","show-overflow-tooltip":"",prop:"projectName",label:"项目"}}),t("el-table-column",{attrs:{"min-width":"200","show-overflow-tooltip":"",prop:"name",label:"作业流[依赖]名称"}}),t("el-table-column",{attrs:{prop:"jobLogType",formatter:e.getJobLogType},scopedSlots:e._u([{key:"header",fn:function(o){return[t("filter-t-b-header",{attrs:{label:"类型",filter:e.options_job_log_type,hasAll:!0,value:e.formInline.job_log_type},on:{"update:value":function(t){return e.$set(e.formInline,"job_log_type",t)},comfirm:e.filter}})]}}])}),t("el-table-column",{attrs:{label:"调度方式"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[e._v("\n          "+e._s(e.mapTypes[o.lastRunType])+"\n        ")]}}])}),t("el-table-column",{attrs:{prop:"createPerName","min-width":"100",label:"责任人"}}),t("el-table-column",{attrs:{label:"状态","min-width":"120"},scopedSlots:e._u([{key:"header",fn:function(o){return[t("filter-t-b-header",{attrs:{label:"运行状态",filter:e.options_state,value:e.formInline.state},on:{"update:value":function(t){return e.$set(e.formInline,"state",t)},comfirm:e.filter}},[t("template",{slot:"foot"},[t("div",{staticStyle:{padding:"0 10px 10px 0","text-align":"right"}},[t("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.formInline.isOutHours,callback:function(t){e.$set(e.formInline,"isOutHours",t)},expression:"formInline.isOutHours"}},[e._v("超时")])],1)])],2)]}},{key:"default",fn:function(o){var n=o.row;return[t("span",{staticClass:"log-status",class:{success:"成功"===n.stateName,fail:"失败"===n.stateName,process:"运行中"===n.stateName,stop:"停止"===n.stateName},attrs:{"data-v-log":""}},[e._v(e._s(n.stateName))]),1==n.isOutHours?t("span",{staticClass:"out_hours"},[e._v("超时")]):e._e()]}}])}),t("el-table-column",{attrs:{"min-width":"120",prop:"costSecond",sortable:"",label:"运行耗时(s)"}}),t("el-table-column",{attrs:{prop:"beginTime","min-width":"180",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"endTime","min-width":"180",label:"结束时间"}}),t("el-table-column",{attrs:{fixed:"right",width:"120",label:"操作","header-align":"right",align:"right"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.logTableHandle(o)}}},[e._v("查看日志")]),e.$checkPermission("taskLog_delete")?t("el-button",{staticClass:"error-color",attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteLog(o.row.id,o.row.jobLogType)}}},[e._v("删除")]):e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.tableData.currPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,total:e.tableData.totalCount,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.sizeChangeHandle,"current-change":e.currentChangeHandle}})],1)],1)}),[],!1,null,"e189f1cc",null);t.default=m.exports}}]);