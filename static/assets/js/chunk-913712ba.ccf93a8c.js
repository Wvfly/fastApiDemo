(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-913712ba"],{"0924":function(t,e,a){"use strict";a("0dd7")},"0dd7":function(t,e,a){var i=a("7c8f");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("499e").default)("9258aa1a",i,!0,{sourceMap:!1,shadowMode:!1})},"27ea":function(t,e,a){"use strict";a("98e6e")},"2d86":function(t,e,a){"use strict";a("935b")},"7c8f":function(t,e,a){(t.exports=a("2350")(!1)).push([t.i,".primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.curTableDetail{height:100%;padding:16px 34px;text-align:left}.curTableDetail .el-table:before{z-index:inherit}.curTableDetail .tableNums{margin:20px 0;text-align:center}.curTableDetail .tableNums li{width:24%;height:100px;padding:30px 0;margin-right:1%;-webkit-box-shadow:0 2px 12px 0 rgba(0,0,0,.1);box-shadow:0 2px 12px 0 rgba(0,0,0,.1);float:left}.curTableDetail .partition_tables{width:100%;padding-bottom:30px;margin-top:20px}.curTableDetail .partition_tables li{width:49%;border:1px solid #ccc}.curTableDetail .partition_tables li .title{font-size:16px;line-height:40px;text-align:center}.curTableDetail .tit{font-size:16px;line-height:40px}",""])},"935b":function(t,e,a){var i=a("a09f");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("499e").default)("576b7f1a",i,!0,{sourceMap:!1,shadowMode:!1})},"98e6e":function(t,e,a){var i=a("cf95");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("499e").default)("11b43848",i,!0,{sourceMap:!1,shadowMode:!1})},a09f:function(t,e,a){(t.exports=a("2350")(!1)).push([t.i,".primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.basicInfo{height:100%}.basicInfo .el-table{height:400px;overflow-y:scroll}.basicInfo .el-link.el-link--primary{width:100%}.basicInfo .loading{margin:20px 0;text-align:center;width:100%}",""])},a82f:function(t,e,a){(t.exports=a("2350")(!1)).push([t.i,".primary-color[data-v-dc696b1c]{color:#1740dc}.success-color[data-v-dc696b1c]{color:#52c41a}.warning-color[data-v-dc696b1c]{color:#faad14}.error-color[data-v-dc696b1c]{color:#f5222d}.info-color[data-v-dc696b1c]{color:#909399}.border-color[data-v-dc696b1c]{border:1px solid #e5e6e9}.wait[data-v-dc696b1c]{color:#f5222d}.checkbox-wrapper[data-v-dc696b1c]{border:1px solid #f1f1f1;max-height:150px;min-height:100px;overflow:auto;position:relative;margin-top:10px;padding-left:10px}.is-not-select[data-v-dc696b1c]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}",""])},abf8:function(t,e,a){var i=a("a82f");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a("499e").default)("46204592",i,!0,{sourceMap:!1,shadowMode:!1})},bbfc:function(t,e,a){"use strict";a("abf8")},cf95:function(t,e,a){(t.exports=a("2350")(!1)).push([t.i,".primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.tool-tip-search{max-width:300px}",""])},f20b:function(t,e,a){"use strict";a.r(e);var i,l,s=a("2909"),o={"data-search":1,"data-warehouse":0,"data-warehouse-related":1},r={data:function(){return{id:this.$route.query.id,pageIndex:1,tableHeight:0,isKey:1,pageSize:10,totalPage:0,isOver:1,isError:0,tableFieldInfos:[],options_isPartition:[{value:0,label:"否"},{value:1,label:"是"}],flag:o[this.$route.query.from]}},methods:{getTableDetail:function(){var t=this;if(0==this.isKey)return!1;this.isKey=0;var e={page:this.pageIndex,limit:this.pageSize,flag:this.flag};this.$API.get(this.$URL.getTableInfoInfo+this.id,e,(function(e){if(0===e.code){var a;if(t.isKey=1,e.data.tableFieldInfos.length>0)(a=t.tableFieldInfos).push.apply(a,Object(s.a)(e.data.tableFieldInfos)),++t.pageIndex;e.data.tableFieldInfos.length<10&&(t.isOver=0)}else t.isError=1,t.$message.error(e.msg)}))},getIsPartition:function(t,e){for(var a in this.options_isPartition)if(this.options_isPartition[a].value==parseInt(t.isPartition))return this.options_isPartition[a].label}},mounted:function(){this.getTableDetail()}},n=(a("2d86"),a("2877")),c=Object(n.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"basicInfo"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableFieldInfos}},[e("el-table-column",{attrs:{prop:"fieldName",label:"字段名","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"fieldType",label:"字段类型","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"isPartition",formatter:t.getIsPartition,label:"分区","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"fieldAlias",label:"业务含义","show-overflow-tooltip":!0}})],1),1==t.isOver&&1==t.isKey&&1!=t.isError?e("el-link",{staticClass:"loading",attrs:{underline:!1,type:"primary"},on:{click:t.getTableDetail}},[t._v("点击加载更多"),e("i",{staticClass:"el-icon-arrow-down"})]):t._e(),0==t.isOver&&1!=t.pageIndex&&1!=t.isError?e("el-link",{staticClass:"loading",attrs:{underline:!1,type:"info"}},[t._v("暂无更多数据")]):t._e()],1)}),[],!1,null,null,null).exports,d=a("2ff0"),p=a("2d2c"),u=a("3d1b"),f=(a("ac6a"),a("456d"),a("96cf"),a("1da1")),b=(a("6762"),a("2fdb"),a("2b0e")),h=a("fedb"),m=function(t){return b.default.http.get(h.a.getTableInfo,{params:t})},g=function(t){return b.default.http.post(h.a.createTableAuth,t)},v=["query","update","delete","export"],y={0:"申请授权",1:"等待授权",2:"申请通过",3:"申请拒绝",4:"再次申请",5:"再次申请"},x={data:function(){var t=this,e=function(e,a,i){if(!t.infinity&&!a)return i(new Error("请选择权限有效期"));i&&i()};return{title:"申请授权",dialogVisible:!1,createData:{tableName:"",authList:[],assign:!1,fieldIds:[],effectiveDeadline:"",applyReason:"",approveUser:"",rejectionReason:""},rules:{effectiveDeadline:[{required:!0,validator:e,trigger:"blur"}],applyReason:[{required:!0,message:"请输入申请理由",trigger:"blur"},{min:1,max:200,message:"长度在200字符以内",trigger:"blur"}]},list:[],infinity:!1,fieldIds:[],checkAll:!1,isIndeterminate:!1,isSubmit:!1,disabled:!1,pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},mapTitle:y,applyStatus:0,checkDuration:e,tableType:null}},computed:{filedDisabled:function(){return!!this.createData.authList.length},tableDisabled:function(){return!this.createData.authList.includes("query")}},methods:{openModal:(l=Object(f.a)(regeneratorRuntime.mark((function t(){var e,a,i,l,s,o,r=this,n=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},this.tableType=e.tableType,a=this.applyStatus=e.applyStatus,this.title=y[a],i=0===a&&{tableId:e.id,tableType:e.tableType}||{applyId:e.applyId,tableType:e.tableType},this.disabled=1==a||2==a,t.prev=7,t.next=10,m(i);case 10:l=t.sent,s=l.data.data,this._tableId=s.tableId,this._userId=s.userId,this.fieldIds=s.tableFieldInfos&&s.tableFieldInfos.map((function(t){return{id:t.id,fieldName:t.fieldName}}))||[],o=Object.keys(s).filter((function(t){return s[t]&&v.includes(t)})),this.checkAll=o.length===v.length,this.dialogVisible=!0,this.$nextTick((function(){var t=s.tableName,e=s.assign,a=s.effectiveDeadline,i=s.applyReason,l=s.approveUser,n=s.rejectionReason,c=s.fieldIds;r.createData={tableName:t,assign:!!e,effectiveDeadline:a,applyReason:i,fieldIds:c||[],authList:o,approveUser:l,rejectionReason:n}})),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(7);case 24:case"end":return t.stop()}}),t,this,[[7,21]])}))),function(){return l.apply(this,arguments)}),handleClose:function(){var t=this;this.dialogVisible=!1,this.$nextTick((function(){t.isSubmit=!1,t.$refs.ruleForm.resetFields(),t.infinity=!1,t.checkAll=!1}))},submit:(i=Object(f.a)(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this,!this.isSubmit){t.next=3;break}return t.abrupt("return");case 3:return this.isSubmit=!0,t.prev=4,t.next=7,this.$refs.ruleForm.validate();case 7:if(this.createData.authList.length||this.createData.fieldIds.length){t.next=11;break}return this.$message.error("请至少选择一个权限"),this.isSubmit=!1,t.abrupt("return");case 11:return a={effectiveDeadline:this.infinity?null:"".concat(this.createData.effectiveDeadline," 23:59:59"),applyReason:this.createData.applyReason,fieldIds:this.createData.authList.length&&[]||this.createData.fieldIds,assign:this.createData.assign?1:0,tableId:this._tableId,userId:this._userId,applyType:this.tableType},v.forEach((function(t){a[t]=e.createData.authList.includes(t)?1:0})),a.all=this.createData.authList.length===v.length?1:0,this.isSubmit=!0,t.next=17,g(a);case 17:t.sent,this.$message.success("保存成功"),this.handleClose(),this.$emit("reload"),t.next=27;break;case 23:t.prev=23,t.t0=t.catch(4),this.isSubmit=!1;case 27:case"end":return t.stop()}}),t,this,[[4,23]])}))),function(){return i.apply(this,arguments)}),selectAll:function(){var t=this.createData.fieldIds.length===this.fieldIds.length;this.createData.fieldIds=t&&[]||this.fieldIds.map((function(t){return t.id}))},handleCheckAllChange:function(t){this.createData.authList=t?v:[]},handleCheckedCitiesChange:function(t){var e=t.length;this.checkAll=e===v.length,t.includes("query")||(this.createData.authList=[])}},watch:{infinity:function(t){t&&this.$refs["data-form-item"].validate("",this.checkDuration)}}},_=(a("bbfc"),a("27ea"),Object(n.a)(x,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.createData,rules:t.rules,"label-width":"120px",disabled:t.disabled,"label-position":"left"}},[e("el-form-item",{attrs:{label:"表名：",prop:"tableName"}},[e("span",[t._v(t._s(t.createData.tableName))])]),e("el-form-item",{attrs:{label:"申请整表权限：",prop:"authList"}},[e("el-checkbox",{attrs:{disabled:t.disabled},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("all")]),e("el-checkbox-group",{staticStyle:{display:"inline-block",margin:"0px 20px"},on:{change:t.handleCheckedCitiesChange},model:{value:t.createData.authList,callback:function(e){t.$set(t.createData,"authList",e)},expression:"createData.authList"}},[e("el-checkbox",{attrs:{label:"query"}},[t._v("查询")]),e("el-checkbox",{attrs:{label:"update",disabled:t.tableDisabled}},[t._v("编辑")]),e("el-checkbox",{attrs:{label:"delete",disabled:t.tableDisabled}},[t._v("删除")]),2!==t.tableType?e("el-checkbox",{attrs:{label:"export",disabled:t.tableDisabled}},[t._v("导出")]):t._e()],1),e("el-tooltip",{staticClass:"item",attrs:{"popper-class":"tool-tip-search",effect:"dark",content:"表权限对整表生效，选择了表权限后，字段权限以表权限为准，对开发任务和数据仓库操作生效",placement:"top-start"}},[e("i",{staticClass:"icon icon-ic_remind"})])],1),e("el-form-item",{attrs:{label:"申请字段权限：",prop:"assign"}},[e("el-checkbox",{attrs:{disabled:t.filedDisabled},model:{value:t.createData.assign,callback:function(e){t.$set(t.createData,"assign",e)},expression:"createData.assign"}},[t._v("新增字段是否默认权限")]),e("el-tooltip",{staticClass:"item",attrs:{"popper-class":"tool-tip-search",effect:"dark",content:"字段权限只针对真实数据生效（在数据开发任务中使用，数据仓库操作不生效），权限为字段的select,insert,若勾选了新增字段默认权限，则表中有新增的字段，默认申请者拥有该字段的权限；若未勾选新增字段默认权限，则表中有新增的字段，申请者也不会拥有该字段的权限",placement:"top-start"}},[e("i",{staticClass:"icon icon-ic_remind"})])],1),e("el-form-item",{attrs:{label:"",prop:"fieldIds"}},[e("div",["等待授权"!==t.title&&"申请通过"!==t.title?e("div",{staticStyle:{float:"right"}},[e("el-button",{attrs:{size:"mini",disabled:t.filedDisabled},on:{click:t.selectAll}},[t._v(t._s(t.createData.fieldIds.length?"清空":"全选"))])],1):t._e(),e("p",[t._v("共"+t._s(t.fieldIds.length)+"个字段")]),e("div",{staticClass:"checkbox-wrapper"},[e("el-checkbox-group",{attrs:{disabled:t.filedDisabled},model:{value:t.createData.fieldIds,callback:function(e){t.$set(t.createData,"fieldIds",e)},expression:"createData.fieldIds"}},t._l(t.fieldIds,(function(a){return e("el-checkbox",{key:a.id,attrs:{label:a.id}},[t._v(t._s(a.fieldName))])})),1)],1)])]),e("el-form-item",{ref:"data-form-item",attrs:{label:"权限有效期：",prop:"effectiveDeadline"}},[e("el-date-picker",{staticStyle:{"margin-right":"30px"},attrs:{"value-format":"yyyy-MM-dd",type:"date","picker-options":t.pickerOptions,placeholder:"选择日期"},model:{value:t.createData.effectiveDeadline,callback:function(e){t.$set(t.createData,"effectiveDeadline",e)},expression:"createData.effectiveDeadline"}}),e("el-checkbox",{attrs:{disabled:t.disabled},model:{value:t.infinity,callback:function(e){t.infinity=e},expression:"infinity"}},[t._v("长期")])],1),e("el-form-item",{attrs:{label:"申请理由：",prop:"applyReason"}},[e("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.createData.applyReason,callback:function(e){t.$set(t.createData,"applyReason","string"==typeof e?e.trim():e)},expression:"createData.applyReason"}})],1),2==t.applyStatus||3==t.applyStatus||1==t.applyStatus?e("el-form-item",{attrs:{label:"审批人："}},[e("span",[t._v("\n            "+t._s(t.createData.approveUser)),"等待授权"===t.title?e("span",{staticClass:"wait"},[t._v("  |  等待审批")]):t._e()])]):t._e(),2==t.applyStatus||3==t.applyStatus||1==t.applyStatus?e("el-form-item",{attrs:{label:"审批理由："}},[e("el-input",{attrs:{type:"textarea",rows:2,disabled:""},model:{value:t.createData.rejectionReason,callback:function(e){t.$set(t.createData,"rejectionReason",e)},expression:"createData.rejectionReason"}})],1):t._e()],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[!t.disabled||t.isSubmit?e("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v(t._s(0==t.applyStatus?"确定":"重新申请"))]):t._e(),e("el-button",{on:{click:t.handleClose}},[t._v(t._s(1===t.applyStatus||2===t.applyStatus?"关闭":"取消"))])],1)],1)}),[],!1,null,"dc696b1c",null).exports),w={"data-search":1,"data-warehouse":0,"data-warehouse-related":1},D={data:function(){return{id:this.$route.query.id,flag:this.$route.query.from,tableStatistics:{rowNum:null,partitionCount:null,addRowNum:null,addSizeStr:null},activeName:"first",tableData:[],tableData02:[],tableInfo:{}}},components:{basicInfo:c,dataRelationship:d.a,uploadData:p.a,dataPreview:u.a,Create:_},methods:{getTableInfo:function(){var t=this,e={flag:w[this.flag],page:1,limit:10};this.$API.get(this.$URL.getTableInfoInfo+this.$route.query.id,e,(function(e){0==e.code?(t.tableInfo=e.data,(!t.$store.state.old.tableInfo||t.$store.state.old.tableInfo.id!=t.$route.query.id||t.$store.state.old.tableInfo.id==t.$route.query.id&&t.$store.state.old.tableInfo.createTime!=e.data.createTime)&&(t.title=e.data.tableAlias,t.description=e.data.tableName+"<br>"+e.data.dbName+"库，"+e.data.format+"格式<br>"+e.data.desc,t.$store.commit("old/changTableInfo",t.tableInfo))):t.$message.error(e.msg)}))},handleClick:function(t,e){},getSaveOfYesterday:function(){var t=this;this.$API.get(this.$URL.getSaveOfYesterday+this.id,{},(function(e){0==e.code?t.tableStatistics=e.data:t.$message.error(e.msg)}))},getTablePartitionStatic01:function(){var t=this;this.$API.get(this.$URL.getTablePartitionStatic+this.id+"/1",{},(function(e){0==e.code?t.tableData02=e.data:t.$message.error(e.msg)}))},getTablePartitionStatic02:function(){var t=this;this.$API.get(this.$URL.getTablePartitionStatic+this.id+"/2",{},(function(e){0==e.code?t.tableData=e.data:t.$message.error(e.msg)}))},applyCreate:function(){this.$refs.create.openModal(this.tableInfo)}},mounted:function(){this.getTableInfo(),this.getSaveOfYesterday(),this.getTablePartitionStatic01(),this.getTablePartitionStatic02()}},I=(a("0924"),Object(n.a)(D,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"curTableDetail"},[e("div",{staticStyle:{float:"right"}},[0===t.tableInfo.applyStatus&&"data-warehouse"!==t.flag&&"data-warehouse-related"!==t.flag?e("el-button",{attrs:{type:"primary"},on:{click:t.applyCreate}},[t._v("申请授权")]):t._e()],1),e("div",{staticClass:"tit"},[t._v(t._s(t.tableStatistics.tableName))]),e("div",[t._v("创建人:"+t._s(t.tableStatistics.createPerName)),e("el-divider",{attrs:{direction:"vertical"}}),t._v("创建时间："+t._s(t.tableStatistics.createTime)),e("el-divider",{attrs:{direction:"vertical"}})],1),e("div",[t._v("所属项目:"+t._s(t.tableInfo.projectName||""))]),e("div",[t._v("描述:"+t._s(t.tableInfo.desc))]),e("ul",{staticClass:"clearfix tableNums"},[e("li",[e("p",[t._v("表数据总条目 "),e("el-tooltip",{attrs:{content:"每天更新一次数据",placement:"top"}},[e("i",{staticClass:"icon icon-ic_remind"})])],1),e("p",{staticClass:"num"},[t._v(t._s(t.tableStatistics.rowNum)+"条")])]),e("li",[e("p",[t._v("分区总数 "),e("el-tooltip",{attrs:{content:"每天更新一次数据",placement:"top"}},[e("i",{staticClass:"icon icon-ic_remind"})])],1),e("p",{staticClass:"num"},[t._v(t._s(t.tableStatistics.partitionCount)+"个")])]),e("li",[e("p",[t._v("昨日数据新增总数 "),e("el-tooltip",{attrs:{content:"每天更新一次数据",placement:"top"}},[e("i",{staticClass:"icon icon-ic_remind"})])],1),e("p",{staticClass:"num"},[t._v(t._s(t.tableStatistics.addRowNum)+"条")])]),e("li",[e("p",[t._v("昨日数据新增总量 "),e("el-tooltip",{attrs:{content:"每天更新一次数据",placement:"top"}},[e("i",{staticClass:"icon icon-ic_remind"})])],1),e("p",{staticClass:"num"},[t._v(t._s(t.tableStatistics.addSizeStr))])])]),e("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[e("basicInfo",{ref:"basicInfo"})],1),e("el-tab-pane",{attrs:{label:"表血缘",name:"second"}},[e("dataRelationship",{ref:"dataRelationship"})],1),"data-warehouse"===t.flag||"data-warehouse-related"===t.flag?e("el-tab-pane",{attrs:{label:"上传数据",name:"third",lazy:!0}},[e("uploadData",{ref:"uploadData"})],1):t._e(),"data-warehouse"===t.flag||"data-warehouse-related"===t.flag?e("el-tab-pane",{attrs:{label:"数据预览",name:"fourth"}},[e("dataPreview",{ref:"dataPreview"})],1):t._e()],1),"first"==t.activeName?e("ul",{staticClass:"clearfix partition_tables"},[e("li",{staticClass:"fl"},[e("div",{staticClass:"title"},[t._v("分区总量前TOP10")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[e("el-table-column",{attrs:{prop:"partitionValue",label:"分区","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"rowNum",label:"分区总量(条)","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"sizeStr",label:"分区大小(G/MB/KB)","show-overflow-tooltip":!0}})],1)],1),e("li",{staticClass:"fr"},[e("div",{staticClass:"title"},[t._v("分区总量后TOP10")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData02}},[e("el-table-column",{attrs:{prop:"partitionValue",label:"分区","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"rowNum",label:"分区总量(条)","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"sizeStr",label:"分区大小(G/MB/KB)","show-overflow-tooltip":!0}})],1)],1)]):t._e(),e("Create",{ref:"create",on:{reload:function(e){return t.getTableInfo()}}})],1)}),[],!1,null,null,null));e.default=I.exports}}]);