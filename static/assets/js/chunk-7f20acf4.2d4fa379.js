(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7f20acf4"],{"132a":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".primary-color{color:#1740dc}.success-color{color:#52c41a}.warning-color{color:#faad14}.error-color{color:#f5222d}.info-color{color:#909399}.border-color{border:1px solid #e5e6e9}.data_security .labelLevel .el-form-item__label{display:block;text-align:left;float:none;font-weight:700}.data_security .labelLevel .el-form-item__content{text-align:left;padding-left:12px}.data_security .edit_row form{text-align:left}.data_security .edit_row .el-input--suffix .el-input__inner{padding-right:6px}.data_security .edit_row .el-form--inline .el-form-item{margin-right:0}.data_security .edit_row .el-select{margin-right:8px}",""])},"230f":function(e,t,a){"use strict";a("9ba9")},"44c7":function(e,t,a){var i=a("a5f0");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("499e").default)("63864182",i,!0,{sourceMap:!1,shadowMode:!1})},"6b19":function(e,t,a){"use strict";a.r(t);a("7f7f"),a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("7514"),a("c5f6"),a("ac6a");function i(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,d=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return n=e.done,e},e:function(e){d=!0,o=e},f:function(){try{n||null==a.return||a.return()}finally{if(d)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}var r={data:function(){return{ishandlechange:"nochange",isLoading:!1,comaddLoading:!1,tableLevelList:[],data:{tableAndFields:{tableFieldInfos:[]}},secretKeyData:[],isAdd:!0,editIndex:-1,dialogTableVisible:!1,rowParamId:"",tableFieldRulesId:"",ruleForm:{editFieldAlias:"",editRowRuleInfo:"",editInput:""},rules:{editFieldAlias:[{required:!0,message:"请选择",trigger:"change"}],editRowRuleInfo:[{required:!0,message:"请选择",trigger:"change"}],editInput:[{required:!0,message:"请输入值",trigger:"blur"}]}}},methods:{getData:function(){var e=this;this.$API.get(this.$URL.getTableFieldRulesData+this.$route.query.id,{},(function(t){if(0==t.code){e.data=t.data;var a=e.data.rowRules,l=e.data.tableAndFields.tableFieldInfos;if(e.data.tableAndFields.tableFieldInfos.forEach((function(t,a){if(t.secretList){for(var i=0;i<t.secretList.length;i++)if(t.secretList[i].id===t.secretId){e.ishasId="true";break}e.ishasId||t.secretList.push({id:e.data.tableAndFields.tableFieldInfos[a].secretId,name:e.data.tableAndFields.tableFieldInfos[a].secretName})}else t.secretList=[{id:e.data.tableAndFields.tableFieldInfos[a].secretId,name:e.data.tableAndFields.tableFieldInfos[a].secretName}]})),a&&a.length>0&&l&&l.length>0){var r,o=i(a);try{for(o.s();!(r=o.n()).done;){var n,d=r.value,s=i(l);try{for(s.s();!(n=s.n()).done;){var c=n.value;d.tableFiledName==c.fieldName&&(d.fieldAlias=c.fieldAlias)}}catch(e){s.e(e)}finally{s.f()}}}catch(e){o.e(e)}finally{o.f()}}}}))},getLevelList:function(){var e=this;this.$API.post(this.$URL.getLevelList,{levelType:1,isNotEmpty:!0},(function(t){0==t.code&&(e.tableLevelList=t.data.map((function(e){return{name:e.name,securityDataLevel:e.securityDataLevel}})))}))},addOrEditRule:function(e,t){"edit"==e?(this.isAdd=!1,this.editIndex=t.$index,this.ruleForm.editFieldAlias=t.row.tableFieldId,this.ruleForm.editRowRuleInfo=t.row.rowRuleId,this.rowParamId=t.row.id,this.tableFieldRulesId=t.row.id,this.ruleForm.editInput=t.row.calValue):(this.isAdd=!0,this.rowParamId=Number(this.data.rowRules.length)+1,this.tableFieldRulesId=""),this.dialogTableVisible=!0},diaClose:function(){this.$refs.ruleForm.resetFields(),this.editIndex=-1},deleteRow:function(e){var t=this;this.$confirm("是否确认删除该行？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a={tableId:t.$route.query.id-0,rowRuleId:e.row.id};t.comaddLoading=!0,t.$API.post(t.$URL.deleteTableFieldRule,a,(function(a){0==a.code?(t.$message.success("行规则删除成功"),t.data.rowRules.splice(e.$index,1)):t.$message.error(a.msg),t.comaddLoading=!1}))})).catch((function(){}))},comAddRow:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(t){var a=e.data.RowRuleInfo.find((function(t){return t.id==e.ruleForm.editRowRuleInfo})),l=e.data.tableAndFields.tableFieldInfos.find((function(t){return t.id==e.ruleForm.editFieldAlias}));20!=e.ruleForm.editRowRuleInfo&&21!=e.ruleForm.editRowRuleInfo||(e.ruleForm.editInput="");var r,o=l.fieldAlias+" "+a.permissName+" "+e.ruleForm.editInput,n=i(e.data.rowRules);try{for(n.s();!(r=n.n()).done;){if(r.value.ruleDesc==o)return void e.$message.error("已经存在相同的规则！")}}catch(e){n.e(e)}finally{n.f()}var d={id:e.rowParamId,tableId:e.$route.query.id,rowRuleFieldId:e.ruleForm.editFieldAlias,rowParamId:e.rowParamId,ruleDesc:o,rowRuleId:e.ruleForm.editRowRuleInfo,calValue:e.ruleForm.editInput};e.comaddLoading=!0,e.$API.post(e.$URL.saveTableFieldRule,d,(function(t){if(0==t.code){var a=t.data;if(e.isAdd)e.data.rowRules.push({ruleDesc:a.ruleDesc,tableFieldId:e.ruleForm.editFieldAlias,calValue:e.ruleForm.editInput,rowRuleId:e.ruleForm.editRowRuleInfo,id:t.data.id});else{var i=[o,l.id,e.ruleForm.editInput,a.id,e.ruleForm.editRowRuleInfo];e.data.rowRules[e.editIndex].ruleDesc=i[0],e.data.rowRules[e.editIndex].tableFieldId=i[1],e.data.rowRules[e.editIndex].calValue=i[2],e.data.rowRules[e.editIndex].id=i[3],e.data.rowRules[e.editIndex].rowRuleId=i[4]}e.dialogTableVisible=!1,e.getData()}else e.$message.error(t.msg);e.comaddLoading=!1}))}}))},updateEnPasswordType:function(e,t,a,i){var l=this;this.isLoading=!0;var r={};r=1===i?{fieldId:e,encyStyleId:t}:{fieldId:e,encyStyleId:t,secretId:a},this.$API.post(this.$URL.updateEnPasswordType,r,(function(e){l.isLoading=!1,0==e.code?l.$message.success("修改成功！"):l.$message.error(e.msg)}))},clearndata:function(e){var t=this;this.data.tableAndFields.tableFieldInfos.forEach((function(a,i){e!=i||(t.data.tableAndFields.tableFieldInfos[i].secretId="")}))},changeEncryption:function(e,t){this.ishandlechange="haschange",this.clearndata(t);var a="";28==e.row.encyStyleId||35==e.row.encyStyleId||36==e.row.encyStyleId?(a="",this.updateEnPasswordType(e.row.id,e.row.encyStyleId,a,1)):a=e.row.secretId,29!=e.row.encyStyleId&&32!=e.row.encyStyleId&&33!=e.row.encyStyleId&&34!=e.row.encyStyleId||e.row.secretId||this.$message.error("请选择秘钥")},changeSecret:function(e){this.updateEnPasswordType(e.row.id,e.row.encyStyleId,e.row.secretId,2)},getSecretList:function(e){var t=this;this.secretKeyData=[],this.$API.get(this.$URL.ownerList,{secret_way:e.row.encyStyleId},(function(e){e.data.length>0?t.secretKeyData=e.data:t.secretKeyData=[]}))},resetForm:function(e){this.$refs[e].resetFields()},save:function(){var e,t=this,a=[],l=(this.data.rowRules,i(this.data.tableAndFields.tableFieldInfos));try{for(l.s();!(e=l.n()).done;){var r=e.value;a.push({fieldId:r.id,fieldLevelId:r.colcumLevelId,encyStyleId:r.encyStyleId,secretId:r.secretId})}}catch(e){l.e(e)}finally{l.f()}for(var o=0;o<a.length;o++)if((29==a[o].encyStyleId||32==a[o].encyStyleId||33==a[o].encyStyleId||34==a[o].encyStyleId)&&!a[o].secretId)return void this.$message.error("加密方式为RSA，AES，RC6，ECC时, 请选择秘钥!");var n={id:this.$route.query.id,tableLevelId:this.data.tableAndFields.tableLevelId,fieldsConfig:a};this.comaddLoading=!0,this.$API.post(this.$URL.getTableFieldRulesSave,n,(function(e){0==e.code?t.$message.success("保存成功"):t.$message.error(e.msg),t.comaddLoading=!1}))}},created:function(){this.getData(),this.getLevelList()}},o=(a("9323"),a("230f"),a("2877")),n=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"check-detail-top it"},[t("div",{staticClass:"top-right",on:{click:function(t){return e.$router.go(-1)}}},[t("i",{staticClass:"el-icon-back"}),e._v("\n      返回\n    ")]),t("div",{staticClass:"top-left"},[e._v("配置加密")])]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.comaddLoading,expression:"comaddLoading"}],staticClass:"data_security"},[t("div",{staticClass:"titile"},[e._v("字段（列）密级")]),t("el-alert",{staticStyle:{"margin-bottom":"12px"},attrs:{title:"* 目前仅支持为STRING类型的字段加密",type:"warning"}}),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{"max-height":"350px",size:"mini",data:e.data.tableAndFields.tableFieldInfos}},[t("el-table-column",{attrs:{label:"字段名",property:"fieldName"}}),t("el-table-column",{attrs:{label:"类型",property:"fieldType"}}),t("el-table-column",{attrs:{label:"分区"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.isPartition?"是":"否")+"\n        ")]}}])}),t("el-table-column",{attrs:{label:"业务含义",property:"fieldAlias"}}),t("el-table-column",{attrs:{label:"密级"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{size:"mini",disabled:""},model:{value:a.row.securityDataLevel,callback:function(t){e.$set(a.row,"securityDataLevel",t)},expression:"scope.row.securityDataLevel"}},e._l(e.tableLevelList,(function(e){var a=e.securityDataLevel,i=e.name;return t("el-option",{key:a,attrs:{value:a,label:i}})})),1)]}}])}),t("el-table-column",{attrs:{label:"加密方式"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{size:"mini",disabled:"STRING"!==a.row.fieldType.toUpperCase()},on:{change:function(t){return e.changeEncryption(a,a.$index)}},model:{value:a.row.encyStyleId,callback:function(t){e.$set(a.row,"encyStyleId",t)},expression:"scope.row.encyStyleId"}},e._l(e.data.EncryptionInfo,(function(e){return t("el-option",{key:e.id,attrs:{label:e.permissName,value:e.id}})})),1)]}}])}),t("el-table-column",{attrs:{label:"秘钥选择"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{size:"mini",disabled:28==a.row.encyStyleId||35==a.row.encyStyleId||36==a.row.encyStyleId},on:{change:function(t){return e.changeSecret(a)},focus:function(t){return e.getSecretList(a)}},model:{value:a.row.secretId,callback:function(t){e.$set(a.row,"secretId",t)},expression:"scope.row.secretId"}},e._l("haschange"!==e.ishandlechange?a.row.secretList:e.secretKeyData,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])})],1),t("div",{staticClass:"titile"},[e._v("行规则")]),t("el-table",{attrs:{size:"mini",data:e.data.rowRules,"max-height":"350px"}},[t("el-table-column",{attrs:{align:"center",label:"规则ID",width:"100",type:"index"}}),t("el-table-column",{attrs:{align:"center",label:"字段名称",property:"tableFiledName"}}),t("el-table-column",{attrs:{align:"center",label:"业务含义",property:"fieldAlias"}}),t("el-table-column",{attrs:{align:"center",label:"规则描述",property:"ruleDesc"}}),t("el-table-column",{attrs:{"header-align":"right",align:"right",width:"100",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-edit",attrs:{title:"编辑"},on:{click:function(t){return e.addOrEditRule("edit",a)}}}),t("i",{staticClass:"el-icon-delete",attrs:{title:"删除"},on:{click:function(t){return e.deleteRow(a)}}})]}}])})],1),t("div",{staticClass:"add_rule"},[t("el-button",{attrs:{type:"text"},on:{click:e.addOrEditRule}},[e._v("+ 添加行规则")])],1),t("div",{staticClass:"save_button"},[t("el-button",{attrs:{type:"primary",loading:e.comaddLoading},on:{click:e.save}},[e._v("保存")])],1),t("el-dialog",{attrs:{title:e.isAdd?"添加行规则":"编辑行规则",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t},close:e.diaClose}},[t("div",{staticClass:"edit_row"},[t("el-form",{ref:"ruleForm",attrs:{inline:!0,model:e.ruleForm,rules:e.rules}},[t("el-form-item",{attrs:{prop:"editFieldAlias"}},[t("el-select",{attrs:{size:"mini",placeholder:"请选择字段名称"},model:{value:e.ruleForm.editFieldAlias,callback:function(t){e.$set(e.ruleForm,"editFieldAlias",t)},expression:"ruleForm.editFieldAlias"}},e._l(e.data.tableAndFields.tableFieldInfos,(function(e){return t("el-option",{key:e.id,attrs:{label:e.fieldName+"("+e.fieldAlias+")",value:e.id}})})),1)],1),t("el-form-item",{attrs:{prop:"editRowRuleInfo"}},[t("el-select",{attrs:{size:"mini",placeholder:"请选择"},model:{value:e.ruleForm.editRowRuleInfo,callback:function(t){e.$set(e.ruleForm,"editRowRuleInfo",t)},expression:"ruleForm.editRowRuleInfo"}},e._l(e.data.RowRuleInfo,(function(e){return t("el-option",{key:e.id,attrs:{label:e.permissName,value:e.id}})})),1)],1),21!=e.ruleForm.editRowRuleInfo&&20!=e.ruleForm.editRowRuleInfo?t("el-form-item",{attrs:{prop:"editInput"}},[t("el-input",{attrs:{size:"mini",placeholder:"输入值"},model:{value:e.ruleForm.editInput,callback:function(t){e.$set(e.ruleForm,"editInput",t)},expression:"ruleForm.editInput"}})],1):e._e()],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{size:"mini",type:"primary",loading:e.comaddLoading},on:{click:e.comAddRow}},[e._v(e._s(e.isAdd?"添加":"确认")+"\n        ")])],1)])],1)])}),[],!1,null,"255b189a",null);t.default=n.exports},9323:function(e,t,a){"use strict";a("44c7")},"9ba9":function(e,t,a){var i=a("132a");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a("499e").default)("b3d57a90",i,!0,{sourceMap:!1,shadowMode:!1})},a5f0:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".primary-color[data-v-255b189a]{color:#1740dc}.success-color[data-v-255b189a]{color:#52c41a}.warning-color[data-v-255b189a]{color:#faad14}.error-color[data-v-255b189a]{color:#f5222d}.info-color[data-v-255b189a]{color:#909399}.border-color[data-v-255b189a]{border:1px solid #e5e6e9}.check-detail-top[data-v-255b189a]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:16px;color:#000;padding:12px 20px;border-bottom:1px solid #e8e8ea;margin-bottom:20px}.check-detail-top .top-right[data-v-255b189a]{color:#000;cursor:pointer;width:140px}.check-detail-top .top-left[data-v-255b189a]{font-weight:700;-webkit-box-flex:1;-ms-flex:1;flex:1;text-align:center}.content-header[data-v-255b189a]{font-size:16px;font-weight:500;line-height:24px;border-bottom:1px solid #e5e6e9;padding:12px 20px;color:#040c2c}.data_security[data-v-255b189a]{margin:16px 34px}.data_security .titile[data-v-255b189a]{font-weight:700;margin-bottom:14px;margin-top:18px;text-align:left}.data_security .add_rule[data-v-255b189a]{text-align:center;background:#e9e9e9}.data_security .edit_row[data-v-255b189a]{display:-webkit-box;display:-ms-flexbox;display:flex}.data_security .el-icon-edit[data-v-255b189a]{color:#1740dc;margin-right:12px;cursor:pointer}.data_security .el-icon-delete[data-v-255b189a]{color:#f56c6c;cursor:pointer}.data_security .save_button[data-v-255b189a]{text-align:left;margin:16px 0}",""])}}]);